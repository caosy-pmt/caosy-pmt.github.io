<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://caosy-pmt.github.io</id>
    <title>Gridea</title>
    <updated>2021-07-14T14:17:39.185Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://caosy-pmt.github.io"/>
    <link rel="self" href="https://caosy-pmt.github.io/atom.xml"/>
    <subtitle>æ¸©æ•…è€ŒçŸ¥æ–°ï¼Œä»…ç”¨äºé˜²é—å¿˜</subtitle>
    <logo>https://caosy-pmt.github.io/images/avatar.png</logo>
    <icon>https://caosy-pmt.github.io/favicon.ico</icon>
    <rights>All rights reserved 2021, Gridea</rights>
    <entry>
        <title type="html"><![CDATA[# Springå­¦ä¹ éšç¬”]]></title>
        <id>https://caosy-pmt.github.io/post/test1/</id>
        <link href="https://caosy-pmt.github.io/post/test1/">
        </link>
        <updated>2021-07-08T16:12:49.000Z</updated>
        <content type="html"><![CDATA[<h2 id="ç¬¬ä¸€ç« -å¯¹springçš„æ€»ä½“å°è±¡"><strong>ç¬¬ä¸€ç« ã€å¯¹Springçš„æ€»ä½“å°è±¡</strong></h2>
<p>1ã€Springæ˜¯ä¸€ä¸ªæ¡†æ¶ï¼Œæ ¸å¿ƒæŠ€æœ¯æœ‰iocï¼ˆæ§åˆ¶åè½¬ï¼‰ã€aopï¼ˆé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼‰ï¼Œç”¨æ¥ä»£ç è§£è€¦åˆã€‚</p>
<p>2ã€Springæ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œå­˜æ”¾çš„æ˜¯javaå¯¹è±¡ï¼Œç”¨äºå¯¹javaå¯¹è±¡çš„åˆ›å»ºã€ç®¡ç†ç­‰ï¼Œæˆ‘ä»¬åœ¨ç¨‹åºä¸­ä»è¿™<br>
ä¸ªå®¹å™¨è·å¾—è¦ä½¿ç”¨çš„å¯¹è±¡ã€‚</p>
<p>3ã€å­˜æ”¾çš„javaå¯¹è±¡æœ‰daoç±»ã€serviceç±»ã€controlerç±»ã€å·¥å…·ç±»ï¼Œé€šè¿‡ä¸¤ç§æ–¹å¼ï¼š<br>
ï¼ˆ1ï¼‰xmlé…ç½®ï¼Œä½¿ç”¨<code>&lt;bean&gt;</code><br>
ï¼ˆ2ï¼‰æ³¨è§£</p>
<p>4ã€ä¸å­˜æ”¾çš„å¯¹è±¡æœ‰å®ä½“ç±»ï¼ˆæ•°æ®åº“ï¼‰ã€servletã€listenerã€filterï¼ˆæ”¾TomcatæœåŠ¡å™¨é‡Œï¼‰ã€‚</p>
<hr>
<h2 id="ç¬¬äºŒç« -iocæ§åˆ¶åè½¬"><strong>ç¬¬äºŒç« ã€IOCæ§åˆ¶åè½¬</strong></h2>
<h3 id="21-iocçš„æ¦‚å¿µ"><strong>2.1 iocçš„æ¦‚å¿µ</strong></h3>
<p>1ã€IoC (Inversion of Control) : æ§åˆ¶åè½¬ï¼Œæ˜¯ä¸€ä¸ªç†è®ºã€æ¦‚å¿µã€æ€æƒ³ã€‚<br>
æ§åˆ¶ï¼šåˆ›å»ºå¯¹è±¡ã€ç»™å¯¹è±¡èµ‹å€¼ã€ç®¡ç†å¯¹è±¡ä¹‹é—´çš„å…³ç³»ï¼›<br>
åè½¬ï¼šä¹‹å‰å¼€å‘æ€»æ˜¯åœ¨ç¨‹åºä¸­ï¼Œå¼€å‘äººå‘˜ç›´æ¥å»æ§åˆ¶ï¼Œç°åœ¨å°†å¼€å‘äººå‘˜çš„è¿™ä¸ªæ§åˆ¶çš„æƒé™ã€ä»»åŠ¡éƒ½äº¤ç»™å®¹å™¨æ¥å®Œæˆã€å®ç°ã€‚</p>
<p>2ã€IoCçš„æŠ€æœ¯å®ç°ï¼šDIï¼ˆDependency Injectionï¼‰ï¼Œä¾èµ–æ³¨å…¥ï¼Œåªéœ€è¦åœ¨ç¨‹åºä¸­æä¾›è¦ä½¿ç”¨çš„å¯¹è±¡åç§°å°±å¯ä»¥ï¼Œ è‡³äºå¯¹è±¡å¦‚ä½•åœ¨å®¹å™¨ä¸­åˆ›å»ºï¼Œèµ‹å€¼ï¼ŒæŸ¥æ‰¾éƒ½ç”±å®¹å™¨å†…éƒ¨å®ç°ã€‚</p>
<hr>
<h3 id="22-å¼€å‘æ­¥éª¤"><strong>2.2ã€å¼€å‘æ­¥éª¤</strong></h3>
<p>å®ç°æ­¥éª¤ï¼š<br>
1.åˆ›å»ºmavené¡¹ç›®<br>
2.åŠ å…¥mavençš„ä¾èµ–<br>
springçš„ä¾èµ–ï¼Œç‰ˆæœ¬5.2.5ç‰ˆæœ¬</p>
<pre><code>&lt;dependency&gt;
    &lt;groupId&gt;org.springframework&lt;/groupId&gt;
    &lt;artifactId&gt;spring-context&lt;/artifactId&gt;
    &lt;version&gt;5.2.5.RELEASE&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<p>3.åˆ›å»ºç±»ï¼ˆæ¥å£å’Œä»–çš„å®ç°ç±»ï¼Œå’Œæ²¡æœ‰ä½¿ç”¨æ¡†æ¶ä¸€æ ·ï¼Œ å°±æ˜¯æ™®é€šçš„ç±»ã€‚</p>
<p>4.åˆ›å»ºspringéœ€è¦ä½¿ç”¨çš„é…ç½®æ–‡ä»¶<br>
å£°æ˜ç±»çš„ä¿¡æ¯ï¼Œè¿™äº›ç±»ç”±springåˆ›å»ºå’Œç®¡ç†<br>
é€šè¿‡springçš„è¯­æ³•ï¼Œå®Œæˆå±æ€§çš„èµ‹å€¼</p>
<p>5.æµ‹è¯•springåˆ›å»ºçš„ã€‚<br>
åˆ›å»ºå®¹å™¨å¯¹è±¡<br>
ï¼ˆ1ï¼‰ã€å®¹å™¨æ¥å£å’Œå®ç°ç±»<br>
ApplicationContext æ¥å£ç”¨äºåŠ è½½ Spring çš„é…ç½®æ–‡ä»¶ï¼Œåœ¨ç¨‹åºä¸­å……å½“â€œå®¹å™¨â€çš„è§’è‰²ã€‚å…¶å®ç°ç±»æœ‰ä¸¤ä¸ªï¼šClassPathXmlApplicationContext()ã€FileSystemXmlApplicationContext()ï¼Œé€šå¸¸ç”¨å‰è€…ï¼Œå‚æ•°ä¸ºresourcesç›®å½•ä¸‹çš„æ‰€éœ€çš„é…ç½®æ–‡ä»¶çš„è·¯å¾„ï¼Œä»¥å­—ç¬¦ä¸²å½¢å¼ã€‚</p>
<p>ï¼ˆ2ï¼‰ã€ApplicationContext å®¹å™¨ä¸­å¯¹è±¡çš„è£…é…æ—¶æœºï¼ŒApplicationContext å®¹å™¨ï¼Œä¼šåœ¨å®¹å™¨å¯¹è±¡åˆ<br>
å§‹åŒ–æ—¶ï¼Œå°†å…¶ä¸­çš„æ‰€æœ‰å¯¹è±¡ä¸€æ¬¡æ€§å…¨éƒ¨è£…é…å¥½ã€‚ä»¥åä»£ç ä¸­è‹¥è¦ä½¿ç”¨åˆ°è¿™äº›å¯¹è±¡ï¼Œåªéœ€ä»å†…å­˜ä¸­ç›´æ¥è·å–å³<br>
å¯ã€‚æ‰§è¡Œæ•ˆç‡è¾ƒé«˜ã€‚ä½†å ç”¨å†…å­˜ã€‚</p>
<pre><code>//æµ‹è¯•
public void test04(){
    String resource = &quot;ba02/applicationContext.xml&quot;;
    ApplicationContext act = new ClassPathXmlApplicationContext(resource);
    Student stu = (Student) act.getBean(&quot;mystudent&quot;);
    System.out.println(&quot;å­¦ç”Ÿ&quot;+stu);
 }
</code></pre>
<hr>
<h3 id="23-åŸºäºxmlçš„di"><strong>2.3ã€åŸºäºXMLçš„DI</strong></h3>
<h4 id="231-setæ³¨å…¥">2.3.1ã€setæ³¨å…¥</h4>
<pre><code>1ã€é¦–å…ˆåœ¨æ‰€æ„é€ å¯¹è±¡çš„ç±»ä¸­å®ç°å…¶setter()æ–¹æ³•ï¼›
2ã€ä½¿ç”¨Springé…ç½®æ–‡ä»¶çš„&lt;bean/&gt;,&lt;property/&gt;æ ‡ç­¾
***
&lt;bean id=&quot;myschool&quot; class=&quot;com.csy.ba01.School&quot;&gt;
    &lt;property name=&quot;name&quot; value=&quot;å®‰å¤§&quot;/&gt;
    &lt;property name=&quot;address&quot; value=&quot;å®‰å¾½åˆè‚¥&quot;/&gt;
&lt;/bean&gt;
***
</code></pre>
<p>ğŸ˜€idï¼šä¸ºè¯¥é…ç½®æ–‡ä»¶ä¸­å”¯ä¸€çš„åç§°ï¼Œä¸å¯é‡èµ·ä¸€è¡Œ<code>&lt;bean/&gt;</code>ç”¨ç›¸åŒçš„idï¼Œç”¨æˆ·è‡ªå®šä¹‰ï¼Œç”¨æ¥å”¯ä¸€æ ‡è¯†æŸå¯¹è±¡ã€‚<br>
ğŸ˜€classï¼šè¯¥å¯¹è±¡çš„å…¨é™å®šç±»åã€‚<br>
ğŸ˜€<code>&lt;property/&gt;</code>ï¼šnameä¸ºç±»çš„å±æ€§åç§°ï¼Œå®¹å™¨è¯»åˆ°è¿™é‡Œä¼šè‡ªåŠ¨è°ƒç”¨Setteræ–¹æ³•å°†(ç®€å•ç±»å‹value)æˆ–è€…(å¼•ç”¨ç±»å‹ref)å€¼èµ‹ç»™ç›¸åº”å±æ€§ã€‚<br>
ğŸ˜€Springå®¹å™¨ä¸€èˆ¬ä¼šå…ˆè°ƒç”¨æ— å‚æ„é€ å‡½æ•°æ„é€ ä¸€ä¸ªå¯¹è±¡ï¼Œå†è°ƒç”¨Setterå‡½æ•°ã€‚</p>
<h4 id="232-æ„é€ æ³¨å…¥">2.3.2ã€æ„é€ æ³¨å…¥</h4>
<pre><code>1ã€é¦–å…ˆåœ¨ç›¸åº”ç±»ä¸­å®ç°å…¶å¸¦å‚æ„é€ å‡½æ•°ï¼Œè¿™é‡Œæ³¨æ„å¤§éƒ¨åˆ†æƒ…å†µä¸‹è¦åŒæ—¶å®ç°æ— å‚æ„é€ ï¼Œå¦åˆ™å½“åŒæ—¶ä½¿
ç”¨setæ³¨å…¥æ—¶ä¼šæŠ¥é”™ï¼Œè‹¥ä¸å†™å¸¦å‚æ„é€ åˆ™æ— å‚æ„é€ åˆ™ä¸å¿…æ‰‹å†™ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å®ç°ã€‚
2ã€ä½¿ç”¨Springé…ç½®æ–‡ä»¶çš„&lt;bean/&gt;,&lt;constructor-arg/&gt;æ ‡ç­¾
***
&lt;bean id=&quot;myschool1&quot; class=&quot;com.csy.ba01.School&quot;&gt;
    &lt;constructor-arg name=&quot;address&quot; value=&quot;å®‰å¾½åˆè‚¥&quot;/&gt;
    &lt;constructor-arg name=&quot;name&quot; value=&quot;ä¸­ç§‘å¤§&quot;/&gt;
&lt;/bean&gt;
***
è¯­æ³•è·Ÿsetç±»ä¼¼
</code></pre>
<h4 id="233-å¼•ç”¨ç±»å‹è‡ªåŠ¨æ³¨å…¥">2.3.3ã€å¼•ç”¨ç±»å‹è‡ªåŠ¨æ³¨å…¥</h4>
<p>1ã€byName<br>
åœ¨<code>&lt;bean/&gt;</code>æ ‡ç­¾ä¸­ï¼Œæ·»åŠ autowireå±æ€§ï¼Œå€¼=&quot;byName&quot;ï¼Œå¯å®ç°å¼•ç”¨ç±»å‹è‡ªåŠ¨æ³¨å…¥ï¼Œä¸å¿…å†ä½¿ç”¨<code>&lt;property/&gt;</code>æ ‡ç­¾ï¼Œæ³¨æ„è¿™é‡Œçš„å¼•ç”¨å¯¹è±¡çš„idå€¼æœ‰è¦æ±‚ï¼Œè¦æ±‚ä¸ºè¯¥å¯¹è±¡ç±»åç§°çš„å…¨éƒ¨å°å†™å½¢å¼ï¼Œå¦‚è¯¥ç±»ä¸ºSchoolç±»ï¼Œè¿™é‡Œidè¦ä¸ºschoolã€‚å¦åˆ™æ„é€ å‡ºçš„å¯¹è±¡ï¼Œè¯¥å¼•ç”¨ç±»å‹ä¸ºç©ºã€‚<br>
<code>&lt;bean id=&quot;mystudent&quot; class=&quot;com.csy.ba01.Student&quot;autowire=&quot;byName&quot;&gt;</code></p>
<p>2ã€byType<br>
åœ¨<code>&lt;bean/&gt;</code>æ ‡ç­¾ä¸­ï¼Œæ·»åŠ autowireå±æ€§ï¼Œå€¼=&quot;byType&quot;ï¼Œä½œç”¨ä¸1ç›¸ä¼¼ï¼Œä½†æ˜¯æ˜¯å‡­ç±»å‹å»æ‰¾ç›¸åº”å¯¹è±¡çš„ï¼Œæ‰€ä»¥å½“éœ€è¦ä½¿ç”¨æ—¶ï¼Œç›¸åº”ç±»å‹çš„å¯¹è±¡ï¼Œå®¹å™¨é‡Œåªèƒ½æœ‰ä¸€ä¸ªã€‚</p>
<h4 id="234-ä¸ºåº”ç”¨æŒ‡å®šå¤šä¸ªspringé…ç½®æ–‡ä»¶">2.3.4ã€ä¸ºåº”ç”¨æŒ‡å®šå¤šä¸ªSpringé…ç½®æ–‡ä»¶</h4>
<p>å½“é…ç½®æ–‡ä»¶ä¸­ä»£ç è¿‡å¤šä¸å¥½ç®¡ç†æ—¶ï¼Œå¯ä»¥å°†å…¶åˆ†ç±»æ”¾å…¥å¤šä¸ªé…ç½®æ–‡ä»¶ä¸­ï¼Œå†ä½¿ç”¨ä¸€ä¸ªå•ç‹¬çš„ä¸æ·»åŠ <code>&lt;bean/&gt;</code>æ ‡ç­¾çš„ä¸»é…ç½®æ–‡ä»¶è¿›è¡Œå¯¼å…¥ï¼Œåœ¨åˆ›å»ºå®¹å™¨å¯¹è±¡æ—¶ï¼Œåªéœ€è¦ç”¨è¿™ä¸ªä¸»é…ç½®çš„è·¯å¾„å³å¯ã€‚</p>
<pre><code>&lt;!--  ä¸»é…ç½®æ–‡ä»¶ --&gt;
&lt;import resource=&quot;classpath:ba02/spring-*.xml&quot;/&gt;
</code></pre>
<p>classpathä¸ºresourcesç›®å½•ä¸‹çš„å…¨é™å®šåç§°ã€‚<br>
*ä¸ºç›¸åŒå‰ç¼€çš„å†™åœ¨ä¸€èµ·ï¼Œä½†ä¸»é…ç½®æ–‡ä»¶ä¸å¯æ˜¯â€œSpring-xxâ€ï¼Œä¼šé™·å…¥æ­»å¾ªç¯å¯¼å…¥ã€‚<br>
å¯æœ‰å¤šä¸ªimportã€‚</p>
<hr>
<h3 id="24-åŸºäºæ³¨è§£çš„di"><strong>2.4ã€åŸºäºæ³¨è§£çš„DI</strong></h3>
<p>å¯¹äº DI ä½¿ç”¨æ³¨è§£ï¼Œå°†ä¸å†éœ€è¦åœ¨ Spring é…ç½®æ–‡ä»¶ä¸­å£°æ˜ bean å®ä¾‹ã€‚éœ€è¦åœ¨ Spring é…ç½®æ–‡ä»¶ä¸­é…ç½®ç»„ä»¶æ‰«æå™¨ï¼Œç”¨äºåœ¨æŒ‡å®šçš„åŸºæœ¬åŒ…ä¸­æ‰«ææ³¨è§£ã€‚<br>
<code>&lt;context:component-scan base-package=&quot;com.csy.ba01&quot;/&gt;</code><br>
åœ¨é…ç½®æ–‡ä»¶ä¸­æ‰“å‡º<code>&lt;com</code> æŒ‰å›è½¦å³å¯ã€‚<br>
base-packageçš„å€¼å¯ä»¥æ˜¯å¤šä¸ªï¼Œæ­¤æ—¶<br>
ç¬¬ä¸€ç§æ–¹æ³•ï¼šç”¨â€œï¼Œâ€æˆ–â€œï¼›â€åˆ†å‰²ï¼Œå¦‚&quot;com.csy.ba01ï¼Œcom.csy.ba02&quot;ï¼›<br>
ç¬¬äºŒç§æ–¹æ³•ï¼šç”¨çˆ¶åŒ…ï¼›<br>
ç¬¬ä¸‰ç§æ–¹æ³•ï¼šå¤šå†™å‡ ä¸ªã€‚</p>
<h4 id="241-å®šä¹‰-bean-çš„æ³¨è§£component">2.4.1 å®šä¹‰ Bean çš„æ³¨è§£@Component</h4>
<p>æ ¼å¼ï¼šåœ¨ç±»åçš„ä¸Šé¢ä¸€è¡Œè¾“å…¥ï¼š<code>@Component(value)</code>,å…¶ä¸­valueä¸ºStringç±»å‹ï¼Œè¡¨ç¤ºbeançš„idçš„æ„æ€ï¼Œè‹¥æ˜¯ä¸å†™ï¼Œåˆ™é»˜è®¤idä¸ºç±»åçš„é¦–å­—æ¯å°å†™ã€‚</p>
<p>å¦å¤–ï¼ŒSpring è¿˜æä¾›äº† 3 ä¸ªåˆ›å»ºå¯¹è±¡çš„æ³¨è§£ï¼š<br>
â¢@Repository  ç”¨äºå¯¹ DAO å®ç°ç±»è¿›è¡Œæ³¨è§£<br>
â¢ @Service  ç”¨äºå¯¹ Service å®ç°ç±»è¿›è¡Œæ³¨è§£<br>
â¢ @Controller  ç”¨äºå¯¹ Controller å®ç°ç±»è¿›è¡Œæ³¨è§£<br>
åˆ›å»ºä¸šåŠ¡å±‚å¯¹è±¡ï¼Œä¸šåŠ¡å±‚å¯¹è±¡å¯ä»¥åŠ å…¥äº‹åŠ¡åŠŸèƒ½ï¼Œ@Controller æ³¨è§£åˆ›å»ºçš„å¯¹è±¡å¯ä»¥ä½œä¸ºå¤„<br>
ç†å™¨æ¥æ”¶ç”¨æˆ·çš„è¯·æ±‚ã€‚<br>
@Repositoryï¼Œ@Serviceï¼Œ@Controller æ˜¯å¯¹@Component æ³¨è§£çš„ç»†åŒ–ï¼Œæ ‡æ³¨ä¸åŒå±‚çš„å¯¹è±¡ã€‚å³æŒä¹…å±‚å¯¹è±¡ï¼Œä¸šåŠ¡å±‚å¯¹è±¡ï¼Œæ§åˆ¶å±‚å¯¹è±¡ã€‚</p>
<h4 id="242-ç®€å•ç±»å‹æ³¨è§£value">2.4.2 ç®€å•ç±»å‹æ³¨è§£@Value</h4>
<p>æ ¼å¼ï¼šåœ¨å±æ€§åçš„ä¸Šé¢ä¸€è¡Œè¾“å…¥ï¼š<code>@Value(value)</code>,å€¼ä¹Ÿä¸ºå­—ç¬¦ä¸²ç±»å‹ï¼Œæ³¨è§£æ–¹å¼ä¸è°ƒç”¨Setteræ–¹æ³•ã€‚</p>
<h4 id="243-å¼•ç”¨ç±»å‹è‡ªåŠ¨æ³¨å…¥">2.4.3 å¼•ç”¨ç±»å‹è‡ªåŠ¨æ³¨å…¥</h4>
<p>1ã€byType,åªéœ€åœ¨ç›¸åº”å±æ€§ä¸Šé¢è¾“å…¥<code>@Autowired</code>,è¯¥æ³¨è§£é»˜è®¤ä½¿ç”¨æŒ‰ç±»å‹è‡ªåŠ¨è£…é… Bean çš„æ–¹å¼ã€‚</p>
<p>2ã€byName,åœ¨ç›¸åº”çš„å±æ€§ä¸Šé¢ä¾æ¬¡åŠ å…¥<code>@Autowired</code>ã€<code>@Qualifier(value)</code>ï¼Œåè€…valueå€¼å³ä¸ºæ‰€è¦å¼•ç”¨ç±»å‹çš„beanå¯¹è±¡çš„idå€¼ã€‚</p>
<h4 id="244-æ³¨è§£ä¸-xml-çš„å¯¹æ¯”">2.4.4 æ³¨è§£ä¸ XML çš„å¯¹æ¯”</h4>
<p>1ã€æ³¨è§£ä¼˜ç‚¹æ˜¯ï¼š<br>
ğŸ˜€æ–¹ä¾¿<br>
ğŸ˜€ç›´è§‚<br>
ğŸ˜€é«˜æ•ˆï¼ˆä»£ç å°‘ï¼Œæ²¡æœ‰é…ç½®æ–‡ä»¶çš„ä¹¦å†™é‚£ä¹ˆå¤æ‚ï¼‰ã€‚</p>
<p>å…¶å¼Šç«¯ä¹Ÿæ˜¾è€Œæ˜“è§ï¼šä»¥ç¡¬ç¼–ç çš„æ–¹å¼å†™å…¥åˆ° Java ä»£ç ä¸­ï¼Œä¿®æ”¹æ˜¯éœ€è¦é‡æ–°ç¼–è¯‘ä»£ç çš„ã€‚<br>
è¿™ä¸ªå¼Šç«¯æˆ‘ä»¬å¯ä»¥é€šè¿‡å†™propertiesé…ç½®æ–‡ä»¶ï¼Œå°†éœ€è¦æ³¨è§£æ³¨å…¥çš„å€¼æ”¾åœ¨ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ä¸­ï¼Œä½¿ç”¨<code>${}</code>å†æ¥å¼•ç”¨ï¼Œå½“é…ç½®æ–‡ä»¶çš„å€¼æ”¹äº†ï¼Œè‡ªç„¶åˆ›å»ºçš„é˜Ÿè±¡å±æ€§ä¾¿ä¹Ÿä¸ä¸€æ ·äº†ã€‚å½“ç¨‹åºéœ€è¦ä¿®æ”¹æ—¶ï¼Œå¯ä»¥åªæ”¹é…ç½®æ–‡ä»¶ä¾¿å¯ã€‚<br>
åœ¨resourcesç›®å½•ä¸‹ä»»æ„ä½ç½®åˆ›å»ºxx.propertiesæ–‡ä»¶ï¼Œæ ¼å¼ä¸ºï¼šid=å€¼ï¼Œå€¼ä¸ç”¨åŠ å¼•å·ä¹‹ç±»çš„ï¼Œæ¯ä¸€ä¸ªidå ä¸€è¡Œã€‚å†åœ¨ç»„ä»¶æ‰«æå™¨ä¸­åŠ å…¥è¯¥é…ç½®æ–‡ä»¶ã€‚ä»£ç å¦‚ä¸‹</p>
<pre><code>&lt;context:property-placeholder location=&quot;config.properties&quot; 
file-encoding=&quot;utf-8&quot;/&gt;
</code></pre>
<p>locationçš„å€¼å³resourcesç›®å½•ä¸‹çš„å…¨é™å®šåç§°ï¼Œå®šä½è¯¥é…ç½®æ–‡ä»¶ã€‚<br>
file-encoding=&quot;utf-8&quot;ï¼Œç”±äºideaä¸­propertiesæ–‡ä»¶çš„é»˜è®¤çš„ç¼–ç æ ¼å¼ä¸­æ–‡ä¼šä¹±ç ï¼Œè¿™é‡Œè®¾ç½®ä¸‹ã€‚<br>
åœ¨ç±»ä¸­ä¾¿å¯ç”¨<code>${propertiesæ–‡ä»¶çš„id}</code>ä»£æ›¿ä¹‹å‰åœ¨ä»£ç ä¸­ç›´æ¥è¾“å…¥çš„å€¼ï¼š<br>
<code>@Value(&quot;${name}&quot;)</code>ã€‚</p>
<p>2ã€XML æ–¹å¼ä¼˜ç‚¹æ˜¯ï¼š<br>
ğŸ˜€é…ç½®å’Œä»£ç æ˜¯åˆ†ç¦»çš„<br>
ğŸ˜€åœ¨ xml ä¸­åšä¿®æ”¹ï¼Œæ— éœ€ç¼–è¯‘ä»£ç ï¼Œåªéœ€é‡å¯æœåŠ¡å™¨å³å¯å°†æ–°çš„é…ç½®åŠ è½½ã€‚<br>
xml çš„ç¼ºç‚¹æ˜¯ï¼šç¼–å†™éº»çƒ¦ï¼Œæ•ˆç‡ä½ï¼Œå¤§å‹é¡¹ç›®è¿‡äºå¤æ‚ã€‚</p>
<hr>
<h2 id="ç¬¬ä¸‰ç« -aopé¢å‘åˆ‡é¢ç¼–ç¨‹"><strong>ç¬¬ä¸‰ç« ã€AOPé¢å‘åˆ‡é¢ç¼–ç¨‹</strong></h2>
<h3 id="31-ä¸ä½¿ç”¨aopçš„å¼€å‘æ–¹å¼"><strong>3.1 ä¸ä½¿ç”¨aopçš„å¼€å‘æ–¹å¼</strong></h3>
<p>é¦–å…ˆæˆ‘ä»¬å®šä¹‰ç›®æ ‡ç±»çš„æ¥å£åŠå…¶æ–¹æ³•ï¼Œç”¨äºé€šè¿‡å®ç°è¯¥æ¥å£å¹¶é‡å†™å…¶æ–¹æ³•æ¥è¿›è¡Œä¸šåŠ¡å¤„ç†ã€‚å½“éœ€è¦æ–°å¢æ—¥å¿—ã€äº‹åŠ¡åŠŸèƒ½ç­‰æ—¶ï¼Œä¸€èˆ¬æœ‰å‡ ç§ä¸åŒçš„å¤„ç†æ–¹å¼ã€‚</p>
<h4 id="311-ä¼ ç»Ÿçš„å¼€å‘">3.1.1ã€ä¼ ç»Ÿçš„å¼€å‘</h4>
<p>1ã€å®ç°æ–¹å¼ï¼šç›´æ¥åœ¨ç›®æ ‡ç±»çš„å®ç°æ–¹æ³•é‡Œä¿®æ”¹ã€æ–°å¢ã€‚<br>
2ã€å¼Šç«¯ï¼šéœ€è¦ä¿®æ”¹æºç ï¼Œæ¶‰åŠæƒé™é—®é¢˜ï¼›ä»£ç å†—ä½™ï¼Œæœ‰æ—¶å€™å¤šä¸ªæ–¹æ³•éƒ½è¦å¢æ·»ç›¸åŒçš„ä»£ç ç‰‡æ®µï¼Œä»£ç é‡å¤æ€§ä¸¥é‡ï¼›ä¸èƒ½ä¸“æ³¨ä¸šåŠ¡é€»è¾‘ä»£ç ï¼Œä»£ç å¯è¯»æ€§å·®ã€‚<br>
ç”±æ­¤ï¼Œä¸æ¨èä½¿ç”¨ã€‚å¯ä»¥é‡‡ç”¨åŠ¨æ€ä»£ç†æ–¹å¼ï¼Œåœ¨ä¸ä¿®æ”¹ä¸»ä¸šåŠ¡é€»è¾‘çš„å‰æä¸‹ï¼Œæ‰©å±•å’Œå¢å¼ºå…¶åŠŸèƒ½ã€‚</p>
<h4 id="312-åŠ¨æ€ä»£ç†">3.1.2ã€åŠ¨æ€ä»£ç†</h4>
<p>1ã€å®ç°æ–¹å¼<br>
ï¼ˆ1ï¼‰jdkåŠ¨æ€ä»£ç†ï¼Œä½¿ç”¨jdkä¸­çš„Proxyï¼ŒMethodï¼ŒInvocaitonHanderlåˆ›å»ºä»£ç†å¯¹è±¡ï¼Œç»™è¯¥ä»£ç†å¢åŠ äº†é¢å¤–çš„åŠŸèƒ½ã€‚jdkåŠ¨æ€ä»£ç†è¦æ±‚ç›®æ ‡ç±»å¿…é¡»å®ç°æ¥å£ã€‚<br>
å®ç°æ­¥éª¤ï¼š</p>
<pre><code>public class MyIncationHandler implements InvocationHandler {

    //ç›®æ ‡å¯¹è±¡
    private Object target; //SomeServiceImplç±»

    public MyIncationHandler(Object target) {
        this.target = target;
    }
    @Override
    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {
        //é€šè¿‡ä»£ç†å¯¹è±¡æ‰§è¡Œæ–¹æ³•æ—¶ï¼Œä¼šè°ƒç”¨æ‰§è¡Œè¿™ä¸ªinvokeï¼ˆï¼‰
        System.out.println(&quot;æ‰§è¡ŒMyIncationHandlerä¸­çš„invoke()&quot;);
        System.out.println(&quot;methodåç§°ï¼š&quot;+method.getName());

        //åœ¨ç›®æ ‡æ–¹æ³•ä¹‹å‰ï¼Œè¾“å‡ºæ—¶é—´ï¼Œå¢åŠ çš„åŠŸèƒ½
        ServiceTools.doLog(); 

        //SomeServiceImpl.doSome()ï¼Œç›®æ ‡ç±»çš„æ–¹æ³•
        method.invoke(target,args); 

        //åœ¨ç›®æ ‡æ–¹æ³•æ‰§è¡Œä¹‹åï¼Œæäº¤äº‹åŠ¡ï¼Œå¢åŠ çš„åŠŸèƒ½
        ServiceTools.doTrans(); 
    }
}
//@Test
//ä½¿ç”¨jdkçš„Proxyåˆ›å»ºä»£ç†å¯¹è±¡

//åˆ›å»ºç›®æ ‡å¯¹è±¡
SomeService target = new SomeServiceImpl();

//åˆ›å»ºInvocationHandlerå¯¹è±¡
InvocationHandler handler = new MyIncationHandler(target);

//ä½¿ç”¨Proxyåˆ›å»ºä»£ç†
SomeService proxy = (SomeService) Proxy.newProxyInstance(
                target.getClass().getClassLoader(),
                target.getClass().getInterfaces(),handler);
//com.sun.proxy.$Proxy0
System.out.println(&quot;proxy======&quot;+proxy.getClass().getName());
//é€šè¿‡ä»£ç†æ‰§è¡Œæ–¹æ³•ï¼Œä¼šè°ƒç”¨handlerä¸­çš„invokeï¼ˆï¼‰
proxy.doSome();
</code></pre>
<p>ï¼ˆ2ï¼‰cglibåŠ¨æ€ä»£ç†ï¼šç¬¬ä¸‰æ–¹çš„å·¥å…·åº“ï¼Œåˆ›å»ºä»£ç†å¯¹è±¡ï¼ŒåŸç†æ˜¯ç»§æ‰¿ã€‚ é€šè¿‡ç»§æ‰¿ç›®æ ‡ç±»ï¼Œåˆ›å»ºå­ç±»ã€‚å­ç±»å°±æ˜¯ä»£ç†å¯¹è±¡ã€‚ è¦æ±‚ç›®æ ‡ç±»ä¸èƒ½æ˜¯finalçš„ï¼Œ æ–¹æ³•ä¹Ÿä¸èƒ½æ˜¯finalçš„ã€‚<br>
2ã€åŠ¨æ€ä»£ç†çš„ä½œç”¨ï¼š<br>
ï¼ˆ1ï¼‰åœ¨ä¸æ”¹å˜ç›®æ ‡ç±»æºä»£ç çš„åŸºç¡€ä¸Šï¼Œå¢åŠ åŠŸèƒ½ï¼›<br>
ï¼ˆ2ï¼‰å‡å°‘äº†ä»£ç é‡å¤<br>
ï¼ˆ3ï¼‰ç›®æ ‡ç±»åªéœ€ä¸“æ³¨ä¸šåŠ¡é€»è¾‘ä»£ç <br>
ï¼ˆ4ï¼‰è§£è€¦åˆï¼Œå®ç°åŠŸèƒ½åˆ†ç¦»ï¼Œè®©ä¸šåŠ¡åŠŸèƒ½å’Œæ—¥å¿—ï¼Œäº‹åŠ¡éä¸šåŠ¡åŠŸèƒ½åˆ†ç¦»ã€‚</p>
<h3 id="32-aopç®€ä»‹"><strong>3.2ã€AOPç®€ä»‹</strong></h3>
<p>1ã€AOPï¼šé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œæ˜¯åŸºäºåŠ¨æ€ä»£ç†çš„ï¼Œå¯ä»¥ä½¿ç”¨jdkã€cglibä¸¤ç§ä»£ç†æ–¹å¼ã€‚AOPå°±æ˜¯åŠ¨æ€ä»£ç†çš„è§„èŒƒåŒ–ï¼ŒæŠŠåŠ¨æ€ä»£ç†çš„å®ç°æ­¥éª¤ã€æ–¹å¼éƒ½å®šä¹‰å¥½äº†ï¼Œè®©å¼€å‘äººå‘˜ä»¥ç»Ÿä¸€çš„æ–¹å¼æ›´åŠ æ–¹ä¾¿ã€ç®€æ´åœ°ä½¿ç”¨åŠ¨æ€ä»£ç†ã€‚<br>
2ã€åˆ‡é¢ï¼šç»™ç›®æ ‡ç±»æ–°å¢åœ°åŠŸèƒ½å°±æ˜¯åˆ‡é¢ï¼Œå¦‚å‰æ–‡çš„æ—¥å¿—ã€äº‹åŠ¡ã€‚<br>
3ã€å®ç°ï¼š<br>
ï¼ˆ1ï¼‰éœ€è¦åœ¨åˆ†æé¡¹ç›®åŠŸèƒ½æ—¶ï¼Œæ‰¾å‡ºåˆ‡é¢ï¼Œæ„é€ åˆ‡é¢ç±»ï¼›<br>
ï¼ˆ2ï¼‰åˆç†å®‰æ’åˆ‡é¢çš„æ‰§è¡Œæ—¶é—´ï¼ˆåœ¨ç›®æ ‡æ–¹æ³•å‰æˆ–æ˜¯åï¼‰<br>
ï¼ˆ3ï¼‰åˆç†å®‰æ’åˆ‡é¢çš„æ‰§è¡Œä½ç½®ï¼ˆåœ¨å“ªä¸ªç±»çš„å“ªä¸ªæ–¹æ³•æ–°å¢åŠŸèƒ½ï¼‰</p>
<h3 id="33-aopç¼–ç¨‹æœ¯è¯­"><strong>3.3ã€AOPç¼–ç¨‹æœ¯è¯­</strong></h3>
<p>ï¼ˆ1ï¼‰ åˆ‡é¢ï¼ˆAspectï¼‰<br>
åˆ‡é¢æ³›æŒ‡äº¤å‰ä¸šåŠ¡é€»è¾‘ï¼Œå®é™…å°±æ˜¯å¯¹ä¸»ä¸šåŠ¡é€»è¾‘çš„ä¸€ç§å¢å¼ºã€‚<br>
ï¼ˆ2ï¼‰ è¿æ¥ç‚¹ï¼ˆJoinPointï¼‰<br>
è¿æ¥ç‚¹æŒ‡å¯ä»¥è¢«åˆ‡é¢ç»‡å…¥çš„å…·ä½“æ–¹æ³•ã€‚é€šå¸¸ä¸šåŠ¡æ¥å£ä¸­çš„æ–¹æ³•å‡ä¸ºè¿æ¥ç‚¹ã€‚<br>
ï¼ˆ3ï¼‰ åˆ‡å…¥ç‚¹ï¼ˆPointcutï¼‰<br>
åˆ‡å…¥ç‚¹æŒ‡å£°æ˜çš„ä¸€ä¸ªæˆ–å¤šä¸ªè¿æ¥ç‚¹çš„é›†åˆã€‚é€šè¿‡åˆ‡å…¥ç‚¹æŒ‡å®šä¸€ç»„æ–¹æ³•ã€‚<br>
è¢«æ ‡è®°ä¸º final çš„æ–¹æ³•æ˜¯ä¸èƒ½ä½œä¸ºè¿æ¥ç‚¹ä¸åˆ‡å…¥ç‚¹çš„ã€‚å› ä¸ºæœ€ç»ˆçš„æ˜¯ä¸èƒ½è¢«ä¿®æ”¹çš„ï¼Œä¸<br>
èƒ½è¢«å¢å¼ºçš„ã€‚<br>
ï¼ˆ4ï¼‰ ç›®æ ‡å¯¹è±¡ï¼ˆTargetï¼‰<br>
ç›®æ ‡å¯¹è±¡æŒ‡å°†è¦è¢«å¢å¼ºçš„å¯¹è±¡ã€‚å³åŒ…å«ä¸»ä¸šåŠ¡é€»è¾‘çš„ç±»çš„å¯¹ è±¡ ã€‚<br>
ï¼ˆ5ï¼‰ é€šçŸ¥ï¼ˆAdviceï¼‰<br>
é€šçŸ¥è¡¨ç¤ºåˆ‡é¢çš„æ‰§è¡Œæ—¶é—´ã€‚ä¸Šä¾‹ä¸­çš„ MyInvocationHandler å°±å¯ä»¥ç†è§£ä¸ºæ˜¯ä¸€ç§é€šçŸ¥ã€‚æ¢ä¸ªè§’åº¦æ¥è¯´ï¼Œé€šçŸ¥å®šä¹‰äº†å¢å¼ºä»£ç åˆ‡å…¥åˆ°ç›®æ ‡ä»£ç çš„æ—¶é—´ç‚¹ï¼Œæ˜¯ç›®æ ‡æ–¹æ³•æ‰§è¡Œä¹‹å‰æ‰§è¡Œï¼Œè¿˜æ˜¯ä¹‹åæ‰§è¡Œç­‰ã€‚é€šçŸ¥ç±»å‹ä¸åŒï¼Œåˆ‡å…¥æ—¶é—´ä¸åŒã€‚</p>
<p>ğŸ˜€åˆ‡å…¥ç‚¹ï¼ˆPointcutï¼‰å®šä¹‰åˆ‡å…¥çš„ä½ç½®ï¼Œé€šçŸ¥ï¼ˆAdviceï¼‰å®šä¹‰åˆ‡å…¥çš„æ—¶é—´ã€‚</p>
<h3 id="34-aspectj-å¯¹-aop-çš„å®ç°"><strong>3.4 AspectJ å¯¹ AOP çš„å®ç°</strong></h3>
<p>AspectJ æ˜¯å®ç°AOPçš„ä¸€ä¸ªéå¸¸å¥½çš„æ¡†æ¶ã€‚Springæœ¬èº«ä¹Ÿå®ç°äº†AOPï¼ŒåŒæ—¶å…¶ä¹Ÿå¼•ç”¨äº†AspectJåˆ°è‡ªå·±çš„æ¡†æ¶ï¼Œåœ¨Springå¼€å‘ä¸­ä¸€èˆ¬éƒ½ä½¿ç”¨çš„æ˜¯AspectJçš„æ–¹å¼ã€‚<br>
AspectJå®˜ç½‘åœ°å€ï¼šhttp://www.eclipse.org/aspectj/</p>
<h4 id="341-aspectj-çš„åˆ‡å…¥ç‚¹è¡¨è¾¾å¼">3.4.1 AspectJ çš„åˆ‡å…¥ç‚¹è¡¨è¾¾å¼</h4>
<p>execution(è®¿é—®æƒé™? æ–¹æ³•è¿”å›å€¼ åŒ…åç±»å?æ–¹æ³•å(å‚æ•°) å¼‚å¸¸ç±»å‹?)<br>
åé¢æœ‰é—®å·çš„ä¸ºå¯çœç•¥å‚æ•°ï¼Œæ¯ä¸ªå‚æ•°é—´ç”¨ç©ºæ ¼éš”å¼€ã€‚<br>
<code>*</code>ï¼š0è‡³ä»»æ„å¤šçš„å­—ç¬¦<br>
<code>..</code>ï¼šç”¨åœ¨æ–¹æ³•å‚æ•°ä¸­è¡¨ç¤ºä»»æ„å¤šä¸ªå‚æ•°ï¼Œç”¨åœ¨åŒ…ååè¡¨ç¤ºå½“å‰åŒ…åŠå­åŒ…çš„è·¯å¾„<br>
<code>..</code>å‡ºç°åœ¨ç±»åä¸­æ—¶ï¼Œåé¢å¿…é¡»è·Ÿ<code>*</code>ï¼Œè¡¨ç¤ºåŒ…ã€å­åŒ…ä¸‹çš„æ‰€æœ‰ç±»ã€‚<br>
ä¸¾ä¾‹ï¼š<br>
<code>execution(public * *(..))</code>ï¼šä»»æ„å…¬å…±æ–¹æ³•ã€‚<br>
<code>execution(* set*(..))</code> ï¼šä»»ä½•ä¸€ä¸ªä»¥â€œsetâ€å¼€å§‹çš„æ–¹æ³•ã€‚<br>
<code>execution(* com.xyz.service.*.*(..))</code>ï¼šå®šä¹‰åœ¨ service åŒ…é‡Œçš„ä»»æ„ç±»çš„ä»»æ„æ–¹æ³•ã€‚<br>
<code>execution(* com.xyz.service..*.*(..))</code>ï¼šå®šä¹‰åœ¨ service åŒ…æˆ–è€…å­åŒ…é‡Œçš„ä»»æ„ç±»çš„ä»»æ„æ–¹æ³•ã€‚<br>
<code>execution(* *..service.*.*(..))</code>ï¼šæŒ‡å®šæ‰€æœ‰åŒ…ä¸‹çš„ serivce å­åŒ…ä¸‹æ‰€æœ‰ç±»ï¼ˆæ¥å£ï¼‰ä¸­æ‰€æœ‰æ–¹æ³•ä¸ºåˆ‡å…¥ç‚¹ã€‚</p>
<h4 id="342-ä½¿ç”¨aspectjå®ç°aopçš„åŸºæœ¬æ­¥éª¤">3.4.2 ä½¿ç”¨Aspectjå®ç°aopçš„åŸºæœ¬æ­¥éª¤</h4>
<p>1ã€æ–°å»ºmavené¡¹ç›®<br>
2ã€åŠ å…¥ä¾èµ–</p>
<pre><code>&lt;!-- springä¾èµ–--&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.springframework&lt;/groupId&gt;
    &lt;artifactId&gt;spring-context&lt;/artifactId&gt;
    &lt;version&gt;5.2.5.RELEASE&lt;/version&gt;
&lt;/dependency&gt;
&lt;!-- aspectjä¾èµ–--&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.springframework&lt;/groupId&gt;
    &lt;artifactId&gt;spring-aspects&lt;/artifactId&gt;
    &lt;version&gt;5.2.5.RELEASE&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<p>3ã€åˆ›å»ºç›®æ ‡ç±»ï¼šæ¥å£å’Œä»–çš„å®ç°ç±»ï¼Œä¸ºå…¶ä¸­çš„æ–¹æ³•å¢åŠ åŠŸèƒ½ã€‚<br>
4ã€åˆ›å»ºåˆ‡é¢ç±»ï¼šæ™®é€šç±»<br>
ï¼ˆ1ï¼‰åœ¨ç±»çš„ä¸Šé¢åŠ å…¥@Aspectï¼›<br>
ï¼ˆ2ï¼‰åœ¨ç±»ä¸­å®šä¹‰æ–¹æ³•ï¼Œæ–¹æ³•å°±æ˜¯åˆ‡é¢è¦æ‰§è¡Œçš„åŠŸèƒ½ä»£ç ï¼Œåœ¨æ–¹æ³•ä¸Šé¢åŠ å…¥é€šçŸ¥æ³¨è§£å¹¶æŒ‡å®šåˆ‡å…¥ç‚¹è¡¨è¾¾å¼ã€‚<br>
5ã€åˆ›å»ºspringçš„é…ç½®æ–‡ä»¶ï¼šå£°æ˜å¯¹è±¡ï¼ˆæ³¨è§£æˆ–xmlï¼‰ï¼ŒæŠŠå¯¹è±¡äº¤ç»™å®¹å™¨ç»Ÿä¸€ç®¡ç†<br>
ï¼ˆ1ï¼‰å£°æ˜ç›®æ ‡å¯¹è±¡<br>
ï¼ˆ2ï¼‰å£°æ˜åˆ‡é¢ç±»å¯¹è±¡<br>
ï¼ˆ3ï¼‰å£°æ˜aspectjæ¡†æ¶ä¸­çš„è‡ªåŠ¨ä»£ç†ç”Ÿæˆå™¨æ ‡ç­¾ã€‚<br>
è‡ªåŠ¨ä»£ç†ç”Ÿæˆå™¨ï¼šç”¨æ¥å®Œæˆä»£ç†å¯¹è±¡çš„è‡ªåŠ¨åˆ›å»ºåŠŸèƒ½çš„ã€‚<code>&lt;aop:aspectj-autoproxy/&gt;</code><br>
é€šè¿‡æ‰«ææ‰¾åˆ°@Aspect å®šä¹‰çš„åˆ‡é¢ç±»ï¼Œå†ç”±åˆ‡é¢ç±»æ ¹æ®åˆ‡å…¥ç‚¹æ‰¾åˆ°ç›®æ ‡ç±»çš„ç›®æ ‡æ–¹æ³•ï¼Œå†ç”±é€šçŸ¥ç±»å‹æ‰¾åˆ°åˆ‡å…¥çš„æ—¶é—´ç‚¹ï¼Œæœ€ç»ˆåˆ›å»ºå‡ºç›®æ ‡ç±»çš„ä»£ç†å¯¹è±¡ï¼Œæœ‰é¢å¤–çš„å¢å¼ºçš„åŠŸèƒ½ã€‚<br>
6ã€æµ‹è¯•</p>
<pre><code>public void test01(){
        String config = &quot;applicationContext.xml&quot;;
        ApplicationContext ac = new ClassPathXmlApplicationContext(config);
        SomeService someService = (SomeService) ac.getBean(&quot;someServiceImpl&quot;);
        //someServiceçš„ç±»å
        System.out.println(&quot;someServiceç±»å:&quot;+someService.getClass().getName());
        someService.doSome(&quot;å¼ ä¸‰&quot;,21);
    }
</code></pre>
<p>ç»“æœï¼š</p>
<pre><code>someServiceç±»å:com.sun.proxy.$Proxy15
æ–°å¢æ—¥å¿—ï¼Œå½“å‰æ—¶é—´ä¸ºSun Jul 11 18:12:22 GMT+08:00 2021
=====æ‰§è¡Œäº†ä¸šåŠ¡æ–¹æ³•=======
</code></pre>
<p>ç”±someServiceç±»åå¯çŸ¥ï¼Œç›®æ ‡æ¥å£ä½¿ç”¨äº†åŠ¨æ€ä»£ç†ï¼Œä»springå®¹å™¨ä¸­è·å–çš„ç›®æ ‡å¯¹è±¡æ˜¯ç»è¿‡aspectä¿®æ”¹åçš„ä»£ç†å¯¹è±¡ã€‚</p>
<h4 id="343-é€šçŸ¥ç±»å‹">3.4.3 é€šçŸ¥ç±»å‹</h4>
<p>1ã€@Before å‰ç½®é€šçŸ¥-æ–¹æ³•æœ‰ JoinPoint å‚æ•°ï¼ˆéå¿…é¡»ï¼‰<br>
æ¯ä¸ªé€šçŸ¥ç±»å‹éƒ½æœ‰JoinPointå‚æ•°ï¼Œè‹¥è¿˜åŒ…å«å…¶ä»–å‚æ•°ï¼ŒJoinPointå‚æ•°è¦æ”¾åœ¨ç¬¬ä¸€ä¸ªä½ç½®ï¼Œé€šè¿‡è¯¥å‚æ•°çš„getæ–¹æ³•å¯ä»¥å¾—åˆ°åˆ‡å…¥ç‚¹è¡¨è¾¾å¼ï¼Œæ–¹æ³•ç­¾åã€ç›®æ ‡æ–¹æ³•çš„å‚æ•°ç­‰ã€‚<br>
åŠŸèƒ½æ–¹æ³•ï¼šï¼ˆ1ï¼‰publicï¼ˆ2ï¼‰æ— è¿”å›å€¼ï¼ˆ3ï¼‰å¯æ— å‚æ•°</p>
<p>2ã€@AfterReturning åç½®é€šçŸ¥-æ³¨è§£æœ‰ returning å±æ€§ï¼ˆéå¿…é¡»ï¼‰<br>
ç”±äºåœ¨æ–¹æ³•æ‰§è¡Œä¹‹åæ‰§è¡Œï¼Œä¸šåŠ¡å¯èƒ½ä¼šæœ‰è¿”å›å€¼ï¼Œæ‰€ä»¥è¯¥é€šçŸ¥æœ‰ä¸€ä¸ªæ³¨è§£å±æ€§ï¼šreturning,ç”¨äºæ¥æ”¶å‰é¢ä¸šåŠ¡æ‰§è¡Œç»“æœä½œä¸ºå‚æ•°ï¼Œè·Ÿä¼ å‚ç±»ä¼¼ï¼Œæœ‰å¼•ç”¨ä¼ å‚å’Œå€¼ä¼ å‚ä¹‹åˆ†ã€‚<br>
åŠŸèƒ½æ–¹æ³•ï¼šï¼ˆ1ï¼‰publicï¼ˆ2ï¼‰æ— è¿”å›å€¼ï¼ˆ3ï¼‰æ–¹æ³•æœ‰å‚æ•°æ—¶æ¨èObjectï¼ˆéå¿…é¡»ï¼‰<br>
éƒ¨åˆ†ä»£ç ï¼š</p>
<pre><code>@AfterReturning(value = &quot;execution(* com.csy.ba01.SomeServiceImpl.doStudent(..))&quot;,returning = &quot;result&quot;)
    public void myafterreturning1(Object result){
        //å¼•ç”¨ä¼ å‚ï¼Œä¸šåŠ¡æ–¹æ³•æ‰§è¡Œåè¿”å›å€¼æ”¹å˜
        Student res=(Student) result;
        res.setName(&quot;æå››&quot;);
        res.setAge(19);
        System.out.println(&quot;åç½®é€šçŸ¥ä¿®æ”¹ç›®æ ‡ç»“æœåresult=&quot;+res);
        //å€¼ä¼ å‚
        result = new Student(&quot;æå››&quot;,18);
        System.out.println(&quot;åç½®é€šçŸ¥ä¿®æ”¹ç›®æ ‡ç»“æœåresult=&quot;+result);
    }   
</code></pre>
<p>returningçš„å€¼å¿…é¡»ä¸æ–¹æ³•ä¸­çš„å‚æ•°åä¸€è‡´</p>
<pre><code>//æµ‹è¯•ç‰‡æ®µ
Student res = proxy.doStudent(&quot;å¼ ä¸‰&quot;,18);
System.out.println(&quot;æœ€ç»ˆå¾—åˆ°çš„ç»“æœ=&quot;+res);
</code></pre>
<p>åœ¨å¼•ç”¨ä¼ å‚ä¸­ï¼Œresç»“æœå˜ä¸ºæå››ï¼Œå€¼ä¼ å‚ä»ä¸ºå¼ ä¸‰ä¸å˜ã€‚<br>
æ€»ç»“å°±æ˜¯åŸºæœ¬æ•°æ®ç±»å‹ä¼ é€’çš„æ˜¯å½¢å‚ï¼Œå½¢å‚ä¸å½±å“å®å‚ï¼›å¼•ç”¨æ•°æ®ç±»å‹ä¼ é€’çš„æ˜¯åœ°å€ï¼Œå½¢å‚åœ¨æ–¹æ³•å†…è¢«æ”¹å˜ï¼Œå®å‚ä¹Ÿä¼šæ”¹å˜ï¼Œè‹¥åœ¨æ–¹æ³•å†…å®ä¾‹åŒ–äº†åŒåå¯¹è±¡ï¼Œå³äº§ç”Ÿäº†æ–°çš„åœ°å€ï¼Œå¯¹è¿™ä¸ªåŒåå¯¹è±¡çš„æ”¹å˜ï¼Œç”±äºåœ°å€ä¸ä¸€æ ·ï¼Œæ‰€ä»¥ä¸å½±å“åŸæ¥çš„å¯¹è±¡ã€‚</p>
<p>3ã€@Around ç¯ç»•é€šçŸ¥-å¢å¼ºæ–¹æ³•æœ‰ ProceedingJoinPointå‚æ•°ï¼ˆå¿…é¡»ï¼‰<br>
ç‰¹ç‚¹ï¼š<br>
ï¼ˆ1ï¼‰å®ƒæ˜¯åŠŸèƒ½æœ€å¼ºçš„é€šçŸ¥<br>
ï¼ˆ2ï¼‰åœ¨ç›®æ ‡æ–¹æ³•çš„å‰å’Œåéƒ½èƒ½å¢å¼ºåŠŸèƒ½ã€‚<br>
ï¼ˆ3ï¼‰å¯æ§åˆ¶ç›®æ ‡æ–¹æ³•æ˜¯å¦è¢«è°ƒç”¨æ‰§è¡Œ<br>
ï¼ˆ4ï¼‰å¯ä¿®æ”¹åŸæ¥çš„ç›®æ ‡æ–¹æ³•çš„æ‰§è¡Œç»“æœã€‚ å½±å“æœ€åçš„è°ƒç”¨ç»“æœ<br>
åŠŸèƒ½æ–¹æ³•ï¼š<br>
ï¼ˆ1ï¼‰public<br>
ï¼ˆ2ï¼‰æ–¹æ³•æœ‰å‚æ•°ï¼Œå›ºå®šçš„å‚æ•°ç±»å‹ ProceedingJoinPointï¼Œ  ProceedingJoinPointç±»ä¸­æœ‰getæ–¹æ³•è·Ÿå‰é¢çš„JoinPointä¸€æ ·ã€proceedingJoinPoint.proceed()ç­‰åŒäºåŠ¨æ€ä»£ç†é‡Œçš„method.invoke()ï¼Œç”¨æ¥æ‰§è¡Œç›®æ ‡æ–¹æ³•çš„ã€‚<br>
ï¼ˆ3ï¼‰å¿…é¡»æœ‰ä¸€ä¸ªè¿”å›å€¼ï¼Œæ¨èä½¿ç”¨Objectï¼Œä¸ºç›®æ ‡æ–¹æ³•è¿”å›çš„ç»“æœï¼Œå¯ä¿®æ”¹ã€‚<br>
ç¯ç»•é€šçŸ¥ï¼šç­‰åŒäºjdkåŠ¨æ€ä»£ç†çš„InvocationHandleræ¥å£ï¼Œç»å¸¸åšäº‹åŠ¡ï¼Œ åœ¨ç›®æ ‡æ–¹æ³•ä¹‹å‰å¼€å¯äº‹åŠ¡ï¼Œæ‰§è¡Œç›®æ ‡æ–¹æ³•ï¼Œ åœ¨ç›®æ ‡æ–¹æ³•ä¹‹åæäº¤äº‹åŠ¡ã€‚</p>
<pre><code>//ä»£ç ç¤ºä¾‹
@Around(value = &quot;execution(* com.csy.ba01.SomeServiceImpl.domore(..))&quot;)
    public Object myaround(ProceedingJoinPoint pjp) throws Throwable {
        Object args[] = pjp.getArgs();
        String res=&quot;&quot;;
        if((int)args[0]&gt;0){
            res = (String)pjp.proceed();
        }
        else{
            res = &quot;error&quot;;
        }
        return res;
    }
</code></pre>
<p>4ã€@AfterThrowing å¼‚å¸¸é€šçŸ¥-æ³¨è§£ä¸­æœ‰ throwing å±æ€§</p>
<pre><code>try {
		
}catch(Exception e){
	//æ­¤å¤„å†™çš„ä¾¿æ˜¯å¼‚å¸¸é€šçŸ¥å¯¹åº”çš„å†…å®¹		
}finally {
		
}
</code></pre>
<pre><code>//ä»£ç ç¤ºä¾‹
@AfterThrowing(value = &quot;execution(* *..SomeServiceImpl.doSecond(..))&quot;,
            throwing = &quot;ex&quot;)
    public void myAfterThrowing(Exception ex) {
        System.out.println(&quot;å¼‚å¸¸é€šçŸ¥ï¼šæ–¹æ³•å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œæ‰§è¡Œï¼š&quot;+ex.getMessage());
        //å‘é€é‚®ä»¶ï¼ŒçŸ­ä¿¡ï¼Œé€šçŸ¥å¼€å‘äººå‘˜
    }
</code></pre>
<p>5ã€@After æœ€ç»ˆé€šçŸ¥</p>
<pre><code>try {
		
}catch(Exception e){
			
}finally {
	//æ­¤å¤„å†™çš„ä¾¿æ˜¯æœ€ç»ˆé€šçŸ¥å¯¹åº”çš„å†…å®¹
}
</code></pre>
<h4 id="344-ä¸€ç‚¹è¡¥å……">3.4.4 ä¸€ç‚¹è¡¥å……</h4>
<p>1ã€@Pointcutç”¨æ³•<br>
å®šä¹‰å’Œç®¡ç†åˆ‡å…¥ç‚¹ï¼Œ å¦‚æœä½ çš„é¡¹ç›®ä¸­æœ‰å¤šä¸ªåˆ‡å…¥ç‚¹è¡¨è¾¾å¼æ˜¯é‡å¤çš„ï¼Œå¯ä»¥å¤ç”¨çš„ï¼Œå¯ä»¥ä½¿ç”¨@Pointcutã€‚</p>
<pre><code>//ä»£ç ç¤ºä¾‹
@Pointcut(&quot;execution(* com.csy.ba01.SomeServiceImpl.domore(..))&quot;)
    private void mypt(){
        //ä»€ä¹ˆéƒ½ä¸å†™
    }
</code></pre>
<p>æ­¤å¤„mypt()ä¾¿å¯æ›¿ä»£åˆ‡å…¥ç‚¹è¡¨è¾¾å¼execution(* com.csy.ba01.SomeServiceImpl.domore(..))äº†ã€‚@Around(&quot;mypt()&quot;)ä¾¿ç­‰ä»·ä¹‹å‰ã€‚<br>
2ã€cglibçš„ä½¿ç”¨<br>
ï¼ˆ1ï¼‰é€šå¸¸æƒ…å†µä¸‹ï¼Œæœ‰æ¥å£çš„ä¸€èˆ¬springä¼šè‡ªåŠ¨è°ƒç”¨jdkåŠ¨æ€ä»£ç†ï¼Œå½“æ²¡æœ‰æ¥å£æ—¶ä¼šä½¿ç”¨cglib<br>
ï¼ˆ2ï¼‰è‹¥æƒ³è¦åœ¨å½“å‰æœ‰æ¥å£çš„æƒ…å†µä¸‹ä½¿ç”¨cglibï¼Œå¯åœ¨è‡ªåŠ¨ä»£ç†ç”Ÿæˆå™¨åŠ å…¥ï¼š<code>proxy-target-class=&quot;true&quot;</code></p>
<p>Springé…ç½®æ–‡ä»¶ä¸­æŒ‡å®šå…¶ä»–é…ç½®æ–‡ä»¶è·¯å¾„ï¼Œè¦ä½¿ç”¨<code>classpath:xxx</code>ã€‚</p>
<h2 id="ç¬¬å››ç« -springå’Œmybatisçš„é›†æˆ"><strong>ç¬¬å››ç« ã€springå’Œmybatisçš„é›†æˆ</strong></h2>
<h3 id="411-åˆ›å»ºmavené¡¹ç›®">4.1.1 åˆ›å»ºmavené¡¹ç›®</h3>
<h3 id="412-åŠ å…¥mavenä¾èµ–">4.1.2 åŠ å…¥mavenä¾èµ–</h3>
<pre><code>&lt;!--springæ ¸å¿ƒioc--&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.springframework&lt;/groupId&gt;
    &lt;artifactId&gt;spring-context&lt;/artifactId&gt;
    &lt;version&gt;5.2.5.RELEASE&lt;/version&gt;
&lt;/dependency&gt;
&lt;!--åšspringäº‹åŠ¡ç”¨åˆ°çš„--&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.springframework&lt;/groupId&gt;
    &lt;artifactId&gt;spring-tx&lt;/artifactId&gt;
    &lt;version&gt;5.2.5.RELEASE&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.springframework&lt;/groupId&gt;
    &lt;artifactId&gt;spring-jdbc&lt;/artifactId&gt;
    &lt;version&gt;5.2.5.RELEASE&lt;/version&gt;
&lt;/dependency&gt;
&lt;!--mybatisä¾èµ–--&gt;
    &lt;dependency&gt;
    &lt;groupId&gt;org.mybatis&lt;/groupId&gt;
    &lt;artifactId&gt;mybatis&lt;/artifactId&gt;
    &lt;version&gt;3.5.1&lt;/version&gt;
&lt;/dependency&gt;
&lt;!--mybatiså’Œspringé›†æˆçš„ä¾èµ–,--&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.mybatis&lt;/groupId&gt;
    &lt;artifactId&gt;mybatis-spring&lt;/artifactId&gt;
    &lt;version&gt;1.3.1&lt;/version&gt;
&lt;/dependency&gt;
&lt;!--mysqlé©±åŠ¨--&gt;
&lt;dependency&gt;
    &lt;groupId&gt;mysql&lt;/groupId&gt;
    &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;
    &lt;version&gt;5.1.9&lt;/version&gt;
&lt;/dependency&gt;
&lt;!--é˜¿é‡Œå…¬å¸çš„æ•°æ®åº“è¿æ¥æ± --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;com.alibaba&lt;/groupId&gt;
    &lt;artifactId&gt;druid&lt;/artifactId&gt;
    &lt;version&gt;1.1.12&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<pre><code>&lt;!--build-æ’ä»¶æ ‡ç­¾--&gt;
&lt;!--ç›®çš„æ˜¯æŠŠsrc/main/javaç›®å½•ä¸­çš„xmlæ–‡ä»¶åŒ…å«åˆ°è¾“å‡ºç»“æœä¸­ã€‚è¾“å‡ºåˆ°classesç›®å½•ä¸­--&gt;
    &lt;resources&gt;
      &lt;resource&gt;
        &lt;directory&gt;src/main/java&lt;/directory&gt;&lt;!--æ‰€åœ¨çš„ç›®å½•--&gt;
        &lt;includes&gt;&lt;!--åŒ…æ‹¬ç›®å½•ä¸‹çš„.properties,.xml æ–‡ä»¶éƒ½ä¼šæ‰«æåˆ°--&gt;
          &lt;include&gt;**/*.properties&lt;/include&gt;
          &lt;include&gt;**/*.xml&lt;/include&gt;
        &lt;/includes&gt;
        &lt;filtering&gt;false&lt;/filtering&gt;
      &lt;/resource&gt;
    &lt;/resources&gt;
</code></pre>
<h3 id="413-åˆ›å»ºå®ä½“ç±»">4.1.3 åˆ›å»ºå®ä½“ç±»</h3>
<h3 id="414-åˆ›å»ºdaoæ¥å£åŠç›¸åº”çš„mapperæ–‡ä»¶">4.1.4 åˆ›å»ºdaoæ¥å£åŠç›¸åº”çš„mapperæ–‡ä»¶</h3>
<h3 id="415-é…ç½®mybatisä¸»é…ç½®æ–‡ä»¶">4.1.5 é…ç½®mybatisä¸»é…ç½®æ–‡ä»¶</h3>
<p>æ¨¡æ¿</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
&lt;!DOCTYPE configuration
      PUBLIC &quot;-//mybatis.org//DTD Config 3.0//EN&quot;
      &quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;&gt;
&lt;configuration&gt;

  &lt;!--settingsï¼šæ§åˆ¶mybatiså…¨å±€è¡Œä¸º--&gt;
  &lt;settings&gt;
      &lt;!--è®¾ç½®mybatisè¾“å‡ºæ—¥å¿—--&gt;
      &lt;setting name=&quot;logImpl&quot; value=&quot;STDOUT_LOGGING&quot;/&gt;
  &lt;/settings&gt;

  &lt;!--è®¾ç½®åˆ«å--&gt;
  &lt;typeAliases&gt;
      &lt;!--name:å®ä½“ç±»æ‰€åœ¨çš„åŒ…å
          è¡¨ç¤ºcom.csy.entityåŒ…ä¸­çš„åˆ—åå°±æ˜¯åˆ«å
          ä½ å¯ä»¥ä½¿ç”¨Studentè¡¨ç¤ºcom.csy.entity.Student
      --&gt;
      &lt;package name=&quot;com.csy.entity&quot;/&gt;
  &lt;/typeAliases&gt;

  &lt;!-- sql mapper(sqlæ˜ å°„æ–‡ä»¶)çš„ä½ç½®--&gt;
  &lt;mappers&gt;
      &lt;!--nameï¼šæ˜¯åŒ…åï¼Œ è¿™ä¸ªåŒ…ä¸­çš„æ‰€æœ‰mapper.xmlä¸€æ¬¡éƒ½èƒ½åŠ è½½--&gt;
      &lt;package name=&quot;com.csy.dao&quot;/&gt;
  &lt;/mappers&gt;
&lt;/configuration&gt;
</code></pre>
<h3 id="416-åˆ›å»ºserviceæ¥å£åŠå…¶å®ç°ç±»å®ç°ç±»é‡Œæœ‰daoå±æ€§">4.1.6 åˆ›å»ºserviceæ¥å£åŠå…¶å®ç°ç±»ï¼Œå®ç°ç±»é‡Œæœ‰daoå±æ€§</h3>
<h3 id="417-é…ç½®springä¸»é…ç½®æ–‡ä»¶å£°æ˜mybatisçš„å¯¹è±¡ç”±springæ¥åˆ›å»º">4.1.7 é…ç½®Springä¸»é…ç½®æ–‡ä»¶ï¼šå£°æ˜mybatisçš„å¯¹è±¡ç”±springæ¥åˆ›å»º</h3>
<p>1ã€æ•°æ®æºDataSourceï¼›<br>
2ã€SqlSessionFactoryï¼›<br>
3ã€daoå¯¹è±¡ï¼Œå®šä¹‰ Mapper æ‰«æé…ç½®å™¨ MapperScannerConfigureï¼Œè‡ªåŠ¨ç”Ÿæˆä»£ç†å¯¹è±¡ï¼›<br>
4ã€service å¯¹è±¡ ï¼Œå‘ Service æ³¨å…¥ Mapperç”Ÿæˆçš„daoä»£ç†å¯¹è±¡ï¼Œdaoå¯¹è±¡çš„é»˜è®¤åç§°æ˜¯ æ¥å£åé¦–å­—æ¯å°å†™ã€‚<br>
æ¨¡æ¿</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
      xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
      xmlns:context=&quot;http://www.springframework.org/schema/context&quot;
      xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans
      http://www.springframework.org/schema/beans/spring-beans.xsd
      http://www.springframework.org/schema/context
      https://www.springframework.org/schema/context/spring-context.xsd&quot;&gt;
   &lt;!--
          æŠŠæ•°æ®åº“çš„é…ç½®ä¿¡æ¯ï¼Œå†™åœ¨ä¸€ä¸ªç‹¬ç«‹çš„æ–‡ä»¶ï¼Œç¼–è¯‘ä¿®æ”¹æ•°æ®åº“çš„é…ç½®å†…å®¹
          springçŸ¥é“jdbc.propertiesæ–‡ä»¶çš„ä½ç½®
       --&gt;
   &lt;context:property-placeholder location=&quot;classpath:jdbc.properties&quot; /&gt;

   &lt;!--å£°æ˜æ•°æ®æºDataSource, ä½œç”¨æ˜¯è¿æ¥æ•°æ®åº“çš„--&gt;
   &lt;bean id=&quot;myDataSource&quot; class=&quot;com.alibaba.druid.pool.DruidDataSource&quot;
         init-method=&quot;init&quot; destroy-method=&quot;close&quot;&gt;
       &lt;!--setæ³¨å…¥ç»™DruidDataSourceæä¾›è¿æ¥æ•°æ®åº“ä¿¡æ¯ --&gt;
       &lt;!--    ä½¿ç”¨å±æ€§é…ç½®æ–‡ä»¶ä¸­çš„æ•°æ®ï¼Œè¯­æ³• ${key} --&gt;
       &lt;property name=&quot;url&quot; value=&quot;${jdbc.url}&quot; /&gt;&lt;!--setUrl()--&gt;
       &lt;property name=&quot;username&quot; value=&quot;${jdbc.username}&quot;/&gt;
       &lt;property name=&quot;password&quot; value=&quot;${jdbc.passwd}&quot; /&gt;
       &lt;property name=&quot;maxActive&quot; value=&quot;${jdbc.max}&quot; /&gt;
   &lt;/bean&gt;

   &lt;!--å£°æ˜çš„æ˜¯mybatisä¸­æä¾›çš„SqlSessionFactoryBeanç±»ï¼Œè¿™ä¸ªç±»å†…éƒ¨åˆ›å»ºSqlSessionFactoryçš„SqlSessionFactory  sqlSessionFactory = new ..--&gt;
   &lt;bean id=&quot;sqlSessionFactory&quot; class=&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;&gt;
       &lt;!--setæ³¨å…¥ï¼ŒæŠŠæ•°æ®åº“è¿æ¥æ± ä»˜ç»™äº†dataSourceå±æ€§--&gt;
       &lt;property name=&quot;dataSource&quot; ref=&quot;myDataSource&quot; /&gt;
       &lt;!--mybatisä¸»é…ç½®æ–‡ä»¶çš„ä½ç½®
          configLocationå±æ€§æ˜¯Resourceç±»å‹ï¼Œè¯»å–é…ç½®æ–‡ä»¶
          å®ƒçš„èµ‹å€¼ï¼Œä½¿ç”¨valueï¼ŒæŒ‡å®šæ–‡ä»¶çš„è·¯å¾„ï¼Œä½¿ç”¨classpath:è¡¨ç¤ºæ–‡ä»¶çš„ä½ç½®
       --&gt;
       &lt;property name=&quot;configLocation&quot; value=&quot;classpath:mybatis.xml&quot; /&gt;
   &lt;/bean&gt;

   &lt;!--åˆ›å»ºdaoå¯¹è±¡ï¼Œä½¿ç”¨SqlSessionçš„getMapperï¼ˆStudentDao.classï¼‰
       MapperScannerConfigurer:åœ¨å†…éƒ¨è°ƒç”¨getMapper()ç”Ÿæˆæ¯ä¸ªdaoæ¥å£çš„ä»£ç†å¯¹è±¡ã€‚--&gt;
   &lt;bean class=&quot;org.mybatis.spring.mapper.MapperScannerConfigurer&quot;&gt;
       &lt;!--æŒ‡å®šSqlSessionFactoryå¯¹è±¡çš„id--&gt;
       &lt;property name=&quot;sqlSessionFactoryBeanName&quot; value=&quot;sqlSessionFactory&quot; /&gt;
       &lt;!--æŒ‡å®šåŒ…åï¼Œ åŒ…åæ˜¯daoæ¥å£æ‰€åœ¨çš„åŒ…åã€‚
           MapperScannerConfigurerä¼šæ‰«æè¿™ä¸ªåŒ…ä¸­çš„æ‰€æœ‰æ¥å£ï¼ŒæŠŠæ¯ä¸ªæ¥å£éƒ½æ‰§è¡Œ
           ä¸€æ¬¡getMapper()æ–¹æ³•ï¼Œå¾—åˆ°æ¯ä¸ªæ¥å£çš„daoå¯¹è±¡ã€‚
           åˆ›å»ºå¥½çš„daoå¯¹è±¡æ”¾å…¥åˆ°springçš„å®¹å™¨ä¸­çš„ã€‚ daoå¯¹è±¡çš„é»˜è®¤åç§°æ˜¯ æ¥å£åé¦–å­—æ¯å°å†™
       --&gt;
       &lt;property name=&quot;basePackage&quot; value=&quot;com.csy.dao&quot;/&gt;
   &lt;/bean&gt;

   &lt;!--å£°æ˜service--&gt;
   &lt;bean id=&quot;studentService&quot; class=&quot;com.csy.service.Impl.StudentServiceImpl&quot;&gt;
       &lt;property name=&quot;studentDao&quot; ref=&quot;studentDao&quot; /&gt;
   &lt;/bean&gt;
&lt;/beans&gt;
</code></pre>
<h3 id="418-æµ‹è¯•">4.1.8 æµ‹è¯•</h3>
<p>springå’Œmybatisæ•´åˆåœ¨ä¸€èµ·ä½¿ç”¨ï¼Œäº‹åŠ¡æ˜¯è‡ªåŠ¨æäº¤çš„ã€‚ æ— éœ€æ‰§è¡ŒSqlSession.commit();</p>
<hr>
<h2 id="ç¬¬äº”ç« -springäº‹åŠ¡"><strong>ç¬¬äº”ç«  Springäº‹åŠ¡</strong></h2>
<h3 id="51spring-çš„äº‹åŠ¡ç®¡ç†"><strong>5.1Spring çš„äº‹åŠ¡ç®¡ç†</strong></h3>
<p>äº‹åŠ¡åŸæœ¬æ˜¯æ•°æ®åº“ä¸­çš„æ¦‚å¿µï¼Œåœ¨ Dao å±‚ã€‚ä½†ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œéœ€è¦å°†äº‹åŠ¡æå‡åˆ°ä¸šåŠ¡å±‚ï¼Œ<br>
å³ Service å±‚ã€‚è¿™æ ·åšæ˜¯ä¸ºäº†èƒ½å¤Ÿä½¿ç”¨äº‹åŠ¡çš„ç‰¹æ€§æ¥ç®¡ç†å…·ä½“çš„ä¸šåŠ¡ã€‚<br>
åœ¨ Spring ä¸­é€šå¸¸å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼æ¥å®ç°å¯¹äº‹åŠ¡çš„ç®¡ç†ï¼š<br>
ï¼ˆ1ï¼‰ä½¿ç”¨ Spring çš„äº‹åŠ¡æ³¨è§£ç®¡ç†äº‹åŠ¡<br>
ï¼ˆ2ï¼‰ä½¿ç”¨ AspectJ çš„ AOP é…ç½®ç®¡ç†äº‹åŠ¡</p>
<h3 id="52-äº‹åŠ¡ç®¡ç†api"><strong>5.2 äº‹åŠ¡ç®¡ç†API</strong></h3>
<h4 id="521-äº‹åŠ¡ç®¡ç†å™¨æ¥å£">5.2.1 äº‹åŠ¡ç®¡ç†å™¨æ¥å£</h4>
<p>äº‹åŠ¡ç®¡ç†å™¨æ˜¯ PlatformTransactionManager æ¥å£å¯¹è±¡ã€‚å…¶ä¸»è¦ç”¨äºå®Œæˆäº‹åŠ¡çš„æäº¤ã€å›<br>
æ»šï¼ŒåŠè·å–äº‹åŠ¡çš„çŠ¶æ€ä¿¡æ¯ã€‚</p>
<p>1ã€å¸¸ç”¨çš„ä¸¤ä¸ªå®ç°ç±»<br>
â¢ DataSourceTransactionManagerï¼šä½¿ç”¨ JDBC æˆ– MyBatis è¿›è¡Œæ•°æ®åº“æ“ä½œæ—¶ä½¿ç”¨ã€‚<br>
â¢ HibernateTransactionManagerï¼šä½¿ç”¨ Hibernate è¿›è¡ŒæŒä¹…åŒ–æ•°æ®æ—¶ä½¿ç”¨ã€‚</p>
<p>2ã€Spring çš„å›æ»šæ–¹å¼<br>
Spring äº‹åŠ¡çš„é»˜è®¤å›æ»šæ–¹å¼æ˜¯ï¼šå‘ç”Ÿè¿è¡Œæ—¶å¼‚å¸¸å’Œ error æ—¶å›æ»šï¼Œå‘ç”Ÿå—æŸ¥(ç¼–è¯‘ä¸é€šè¿‡)å¼‚å¸¸æ—¶<br>
æäº¤ã€‚ä¸è¿‡ï¼Œå¯¹äºå—æŸ¥å¼‚å¸¸ï¼Œç¨‹åºå‘˜ä¹Ÿå¯ä»¥æ‰‹å·¥è®¾ç½®å…¶å›æ»šæ–¹å¼ã€‚</p>
<p>3ã€é”™è¯¯å’Œå¼‚å¸¸<br>
Error æ˜¯ç¨‹åºåœ¨è¿è¡Œè¿‡ç¨‹ä¸­å‡ºç°çš„æ— æ³•å¤„ç†çš„é”™è¯¯ï¼Œæ¯”å¦‚ OutOfMemoryErrorã€<br>
ThreadDeathã€NoSuchMethodError ç­‰ã€‚å½“è¿™äº›é”™è¯¯å‘ç”Ÿæ—¶ï¼Œç¨‹åºæ˜¯æ— æ³•å¤„ç†ï¼ˆæ•è·æˆ–æŠ›å‡ºï¼‰<br>
çš„ï¼ŒJVM ä¸€èˆ¬ä¼šç»ˆæ­¢çº¿ç¨‹ã€‚<br>
è¿è¡Œæ—¶å¼‚å¸¸ï¼Œæ˜¯ RuntimeException ç±»æˆ–å…¶å­ç±»ï¼Œå¦‚ï¼ŒNullPointerExceptionã€ArrayIndexOutOfBoundsExceptionï¼ŒIllegalArgumentException ç­‰ã€‚<br>
å—æŸ¥å¼‚å¸¸ï¼Œä¹Ÿå«ç¼–è¯‘æ—¶å¼‚å¸¸ï¼Œå³åœ¨ä»£ç ç¼–å†™æ—¶è¦æ±‚å¿…é¡»æ•è·æˆ–æŠ›å‡ºçš„å¼‚å¸¸ï¼Œè‹¥ä¸å¤„ç†ï¼Œ<br>
åˆ™æ— æ³•é€šè¿‡ç¼–è¯‘ã€‚å¦‚ SQLExceptionï¼ŒClassNotFoundExceptionï¼ŒIOException ç­‰éƒ½å±äºå—æŸ¥å¼‚å¸¸ã€‚<br>
ç¨‹åºå‘˜åœ¨å®šä¹‰å¼‚å¸¸æ—¶ï¼Œåªè¦æœªæ˜ç¡®å£°æ˜å®šä¹‰ä¸º RuntimeException çš„å­ç±»ï¼Œé‚£ä¹ˆå®šä¹‰çš„å°±æ˜¯å—æŸ¥å¼‚å¸¸ã€‚</p>
<h4 id="522-äº‹åŠ¡å®šä¹‰æ¥å£">5.2.2 äº‹åŠ¡å®šä¹‰æ¥å£</h4>
<p>äº‹åŠ¡å®šä¹‰æ¥å£ TransactionDefinition ä¸­å®šä¹‰äº†äº‹åŠ¡æè¿°ç›¸å…³çš„ä¸‰ç±»å¸¸é‡ï¼šäº‹åŠ¡éš”ç¦»çº§åˆ«ã€<br>
äº‹åŠ¡ä¼ æ’­è¡Œä¸ºã€äº‹åŠ¡é»˜è®¤è¶…æ—¶æ—¶é™ï¼ŒåŠå¯¹å®ƒä»¬çš„æ“ä½œã€‚<br>
1ã€å®šä¹‰äº†äº”ä¸ªäº‹åŠ¡éš”ç¦»çº§åˆ«å¸¸é‡<br>
è¿™äº›å¸¸é‡å‡æ˜¯ä»¥ ISOLATION_å¼€å¤´ã€‚å³å½¢å¦‚ ISOLATION_XXXã€‚<br>
â¢ DEFAULTï¼šé‡‡ç”¨ DB é»˜è®¤çš„äº‹åŠ¡éš”ç¦»çº§åˆ«ã€‚MySql çš„é»˜è®¤ä¸º REPEATABLE_READï¼› Oracle<br>
é»˜è®¤ä¸º READ_COMMITTEDã€‚<br>
â¢ READ_UNCOMMITTEDï¼šè¯»æœªæäº¤ã€‚æœªè§£å†³ä»»ä½•å¹¶å‘é—®é¢˜ã€‚<br>
â¢ READ_COMMITTEDï¼šè¯»å·²æäº¤ã€‚è§£å†³è„è¯»ï¼Œå­˜åœ¨ä¸å¯é‡å¤è¯»ä¸å¹»è¯»ã€‚<br>
â¢ REPEATABLE_READï¼šå¯é‡å¤è¯»ã€‚è§£å†³è„è¯»ã€ä¸å¯é‡å¤è¯»ï¼Œå­˜åœ¨å¹»è¯»<br>
â¢ SERIALIZABLEï¼šä¸²è¡ŒåŒ–ã€‚ä¸å­˜åœ¨å¹¶å‘é—®é¢˜ã€‚</p>
<p>2ã€ å®šä¹‰äº†ä¸ƒä¸ªäº‹åŠ¡ä¼ æ’­è¡Œä¸ºå¸¸é‡<br>
æ‰€è°“äº‹åŠ¡ä¼ æ’­è¡Œä¸ºæ˜¯æŒ‡ï¼Œå¤„äºä¸åŒäº‹åŠ¡ä¸­çš„æ–¹æ³•åœ¨ç›¸äº’è°ƒç”¨æ—¶ï¼Œæ‰§è¡ŒæœŸé—´äº‹åŠ¡çš„ç»´æŠ¤æƒ…<br>
å†µã€‚å¦‚ï¼ŒA äº‹åŠ¡ä¸­çš„æ–¹æ³• doSome()è°ƒç”¨ B äº‹åŠ¡ä¸­çš„æ–¹æ³• doOther()ï¼Œåœ¨è°ƒç”¨æ‰§è¡ŒæœŸé—´äº‹åŠ¡çš„<br>
ç»´æŠ¤æƒ…å†µï¼Œå°±ç§°ä¸ºäº‹åŠ¡ä¼ æ’­è¡Œä¸ºã€‚äº‹åŠ¡ä¼ æ’­è¡Œä¸ºæ˜¯åŠ åœ¨æ–¹æ³•ä¸Šçš„ã€‚<br>
äº‹åŠ¡ä¼ æ’­è¡Œä¸ºå¸¸é‡éƒ½æ˜¯ä»¥ PROPAGATION_ å¼€å¤´ï¼Œå½¢å¦‚ PROPAGATION_XXXã€‚<br>
PROPAGATION_REQUIRED<br>
PROPAGATION_REQUIRES_NEW<br>
PROPAGATION_SUPPORTS</p>
<p>PROPAGATION_MANDATORY<br>
PROPAGATION_NESTED<br>
PROPAGATION_NEVER<br>
PROPAGATION_NOT_SUPPORTED<br>
ä»…å‰é¢ä¸‰ä¸ªå¸¸ç”¨ã€‚<br>
ï¼ˆ1ï¼‰ PROPAGATION_REQUIREDï¼šï¼ˆæœ€å¸¸ç”¨ï¼‰<br>
æŒ‡å®šçš„æ–¹æ³•å¿…é¡»åœ¨äº‹åŠ¡å†…æ‰§è¡Œã€‚è‹¥å½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œå°±åŠ å…¥åˆ°å½“å‰äº‹åŠ¡ä¸­ï¼›è‹¥å½“å‰æ²¡æœ‰äº‹<br>
åŠ¡ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°äº‹åŠ¡ã€‚<br>
ï¼ˆ2ï¼‰PROPAGATION_SUPPORTS<br>
æŒ‡å®šçš„æ–¹æ³•æ”¯æŒå½“å‰äº‹åŠ¡ï¼Œä½†è‹¥å½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œä¹Ÿå¯ä»¥ä»¥éäº‹åŠ¡æ–¹å¼æ‰§è¡Œã€‚<br>
ï¼ˆ3ï¼‰PROPAGATION_REQUIRES_NEW<br>
æ€»æ˜¯æ–°å»ºä¸€ä¸ªäº‹åŠ¡ï¼Œè‹¥å½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œå°±å°†å½“å‰äº‹åŠ¡æŒ‚èµ·ï¼Œç›´åˆ°æ–°äº‹åŠ¡æ‰§è¡Œå®Œæ¯•ã€‚</p>
<p>3ã€å®šä¹‰äº†é»˜è®¤äº‹åŠ¡è¶…æ—¶æ—¶é™<br>
å¸¸é‡ TIMEOUT_DEFAULT å®šä¹‰äº†äº‹åŠ¡åº•å±‚é»˜è®¤çš„è¶…æ—¶æ—¶é™ï¼Œsql è¯­å¥çš„æ‰§è¡Œæ—¶é•¿ã€‚<br>
æ³¨æ„ï¼Œäº‹åŠ¡çš„è¶…æ—¶æ—¶é™èµ·ä½œç”¨çš„æ¡ä»¶æ¯”è¾ƒå¤šï¼Œä¸”è¶…æ—¶çš„æ—¶é—´è®¡ç®—ç‚¹è¾ƒå¤æ‚ã€‚æ‰€ä»¥ï¼Œè¯¥<br>
å€¼ä¸€èˆ¬å°±ä½¿ç”¨é»˜è®¤å€¼å³å¯ã€‚</p>
<hr>
<h3 id="53-ç¨‹åºä¸¾ä¾‹æµç¨‹"><strong>5.3 ç¨‹åºä¸¾ä¾‹æµç¨‹</strong></h3>
<p>å¤§è‡´æµç¨‹ä¸ç¬¬å››ç« ç±»ä¼¼ï¼Œéƒ¨åˆ†æ·»åŠ ï¼š<br>
1ã€å¼‚å¸¸ç±»è‡ªå®šä¹‰ï¼š</p>
<pre><code>public class NotExistException extends RuntimeException{
    public NotExistException(){
        super();
    }
    public  NotExistException(String msg){
        super(msg);
    }
}
</code></pre>
<p>è°ƒç”¨ï¼š<code>throw new NotExistException(&quot;xxxä¸å­˜åœ¨&quot;)</code>ã€‚</p>
<p>2ã€æ³¨è§£æ³•ä½¿ç”¨springçš„äº‹åŠ¡å¤„ç†----é€‚åˆä¸­å°é¡¹ç›®<br>
ï¼ˆ1ï¼‰å£°æ˜äº‹åŠ¡ç®¡ç†å™¨</p>
<pre><code>    &lt;!--1. å£°æ˜äº‹åŠ¡ç®¡ç†å™¨--&gt;
    &lt;bean id=&quot;transactionManager&quot; class=&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;&gt;
        &lt;!--è¿æ¥çš„æ•°æ®åº“ï¼Œ æŒ‡å®šæ•°æ®æº--&gt;
        &lt;property name=&quot;dataSource&quot; ref=&quot;myDataSource&quot; /&gt;
    &lt;/bean&gt;
</code></pre>
<p>ï¼ˆ2ï¼‰å¼€å¯äº‹åŠ¡æ³¨è§£é©±åŠ¨</p>
<pre><code>    &lt;!--2. å¼€å¯äº‹åŠ¡æ³¨è§£é©±åŠ¨ï¼Œå‘Šè¯‰springä½¿ç”¨æ³¨è§£ç®¡ç†äº‹åŠ¡ï¼Œåˆ›å»ºä»£ç†å¯¹è±¡ã€‚
           transaction-manager:äº‹åŠ¡ç®¡ç†å™¨å¯¹è±¡çš„id
    --&gt;
    &lt;tx:annotation-driven transaction-manager=&quot;transactionManager&quot; /&gt;
</code></pre>
<p>ï¼ˆ3ï¼‰åœ¨æ–¹æ³•ä¸Šæ–¹ä¸­æ³¨è§£ä¸Š</p>
<pre><code>@Transactional(propagation = Propagation.REQUIRED,
            rollbackFor = {NotExistException.class,NotEnoughException.class})
    public void buy(Integer goosId, Integer amount) {
</code></pre>
<p>ï¼ˆ4ï¼‰æ³¨è§£ä¸­çš„å±æ€§<br>
â¢ propagationï¼šç”¨äºè®¾ç½®äº‹åŠ¡ä¼ æ’­å±æ€§ã€‚è¯¥å±æ€§ç±»å‹ä¸º Propagation æšä¸¾ï¼Œé»˜è®¤å€¼ä¸º<br>
Propagation.REQUIREDã€‚<br>
â¢ isolationï¼šç”¨äºè®¾ç½®äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ã€‚è¯¥å±æ€§ç±»å‹ä¸º Isolation æšä¸¾ï¼Œé»˜è®¤å€¼ä¸º<br>
Isolation.DEFAULTã€‚<br>
â¢ readOnlyï¼šç”¨äºè®¾ç½®è¯¥æ–¹æ³•å¯¹æ•°æ®åº“çš„æ“ä½œæ˜¯å¦æ˜¯åªè¯»çš„ã€‚è¯¥å±æ€§ä¸º booleanï¼Œé»˜è®¤å€¼ä¸º falseã€‚<br>
â¢ timeoutï¼šç”¨äºè®¾ç½®æœ¬æ“ä½œä¸æ•°æ®åº“è¿æ¥çš„è¶…æ—¶æ—¶é™ã€‚å•ä½ä¸ºç§’ï¼Œç±»å‹ä¸º intï¼Œé»˜è®¤å€¼ä¸º-1ï¼Œå³æ²¡æœ‰æ—¶é™ã€‚<br>
â¢ rollbackForï¼šæŒ‡å®šéœ€è¦å›æ»šçš„å¼‚å¸¸ç±»ã€‚ç±»å‹ä¸º Class[]ï¼Œé»˜è®¤å€¼ä¸ºç©ºæ•°ç»„ã€‚å½“ç„¶ï¼Œè‹¥åªæœ‰ä¸€ä¸ªå¼‚å¸¸ç±»æ—¶ï¼Œå¯ä»¥ä¸ä½¿ç”¨æ•°ç»„ã€‚<br>
â¢ rollbackForClassNameï¼šæŒ‡å®šéœ€è¦å›æ»šçš„å¼‚å¸¸ç±»ç±»åã€‚ç±»å‹ä¸º String[]ï¼Œé»˜è®¤å€¼ä¸ºç©ºæ•°ç»„ã€‚å½“ç„¶ï¼Œè‹¥åªæœ‰ä¸€ä¸ªå¼‚å¸¸ç±»æ—¶ï¼Œå¯ä»¥ä¸ä½¿ç”¨æ•°ç»„ã€‚<br>
â¢ noRollbackForï¼šæŒ‡å®šä¸éœ€è¦å›æ»šçš„å¼‚å¸¸ç±»ã€‚ç±»å‹ä¸º Class[]ï¼Œé»˜è®¤å€¼ä¸ºç©ºæ•°ç»„ã€‚å½“ç„¶ï¼Œè‹¥åªæœ‰ä¸€ä¸ªå¼‚å¸¸ç±»æ—¶ï¼Œå¯ä»¥ä¸ä½¿ç”¨æ•°ç»„ã€‚<br>
â¢ noRollbackForClassNameï¼šæŒ‡å®šä¸éœ€è¦å›æ»šçš„å¼‚å¸¸ç±»ç±»åã€‚ç±»å‹ä¸º String[]ï¼Œé»˜è®¤å€¼ä¸ºç©ºæ•°ç»„ã€‚å½“ç„¶ï¼Œè‹¥åªæœ‰ä¸€ä¸ªå¼‚å¸¸ç±»æ—¶ï¼Œå¯ä»¥ä¸ä½¿ç”¨æ•°ç»„ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ@Transactional è‹¥ç”¨åœ¨æ–¹æ³•ä¸Šï¼Œåªèƒ½ç”¨äº public æ–¹æ³•ä¸Šã€‚@Transactional è‹¥ç”¨åœ¨ç±»ä¸Šï¼Œè¡¨ç¤ºè¯¥ç±»ä¸­æ‰€æœ‰æ–¹æ³•æ‰§è¡Œæ—¶éƒ½ä¼šç»‡å…¥äº‹åŠ¡ã€‚</p>
<p>3ã€ä½¿ç”¨aopæ·»åŠ äº‹åŠ¡<br>
ï¼ˆ1ï¼‰åŠ å…¥mavenä¾èµ–</p>
<pre><code>&lt;dependency&gt;
      &lt;groupId&gt;org.springframework&lt;/groupId&gt;
      &lt;artifactId&gt;spring-aspects&lt;/artifactId&gt;
      &lt;version&gt;5.2.5.RELEASE&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<p>ï¼ˆ2ï¼‰å£°æ˜äº‹åŠ¡ç®¡ç†å™¨</p>
<pre><code>&lt;!--1. å£°æ˜äº‹åŠ¡ç®¡ç†å™¨--&gt;
&lt;bean id=&quot;transactionManager&quot; class=&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;&gt;
    &lt;!--è¿æ¥çš„æ•°æ®åº“ï¼Œ æŒ‡å®šæ•°æ®æº--&gt;
    &lt;property name=&quot;dataSource&quot; ref=&quot;myDataSource&quot; /&gt;
&lt;/bean&gt;
</code></pre>
<p>ï¼ˆ3ï¼‰é…ç½®äº‹åŠ¡é€šçŸ¥ï¼ˆåˆ‡å…¥æ—¶æœº+æ–¹æ³•åç§°ï¼‰<br>
ä¸ºäº‹åŠ¡é€šçŸ¥è®¾ç½®ç›¸å…³å±æ€§ï¼ˆä¸å†™å°±ä¸ºé»˜è®¤å€¼ï¼Œä¸æ³¨è§£ä¸€è‡´ï¼‰ã€‚ç”¨äºæŒ‡å®šè¦å°†äº‹åŠ¡ä»¥ä»€ä¹ˆæ–¹å¼ç»‡å…¥ç»™å“ªäº›æ–¹æ³•ã€‚</p>
<pre><code>&lt;tx:advice id=&quot;myadvice&quot; transaction-manager=&quot;transactionManager&quot; &gt;
    &lt;tx:attributes&gt;
        &lt;tx:method name=&quot;buy&quot; /&gt;
            &lt;!--ä½¿ç”¨é€šé…ç¬¦ï¼ŒæŒ‡å®šå¾ˆå¤šçš„æ–¹æ³•--&gt;
        &lt;tx:method name=&quot;add*&quot; propagation=&quot;REQUIRES_NEW&quot; /&gt;
    &lt;/tx:attributes&gt;
&lt;/tx:advice&gt;
</code></pre>
<p>ï¼ˆ4ï¼‰é…ç½®å¢å¼ºå™¨---å…³è”ç»„åˆäº‹åŠ¡é€šçŸ¥å’Œåˆ‡å…¥ç‚¹è¡¨è¾¾å¼</p>
<pre><code>&lt;aop:config&gt;
    &lt;aop:pointcut  expression=&quot;execution(* *..service..*.*(..))&quot; id=&quot;servicePt&quot;/&gt;
    &lt;aop:advisor advice-ref=&quot;myadvice&quot; pointcut-ref=&quot;servicePt&quot;/&gt;
&lt;/aop:config&gt;
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Javaé‡æ–°å†™sortå‡½æ•°]]></title>
        <id>https://caosy-pmt.github.io/post/java-chong-xin-xie-sort-han-shu-de-jie-ding-fang-fa/</id>
        <link href="https://caosy-pmt.github.io/post/java-chong-xin-xie-sort-han-shu-de-jie-ding-fang-fa/">
        </link>
        <updated>2021-07-05T07:52:23.000Z</updated>
        <content type="html"><![CDATA[<p><em><strong>æ“ä½œlistï¼šé‡å†™Collections.sort()</strong></em></p>
<pre><code>Collections.sort(list, new Comparator&lt;Integer&gt;() { 
    //listå³ä¸ºè¦æ’åºçš„åˆ—è¡¨ï¼›Integerä¸ºåˆ—è¡¨å­˜æ”¾çš„æ•°æ®ç±»å‹ï¼Œä¹Ÿå³è¦æ’åºæ•°æ®çš„æ•°æ®ç±»å‹
    			public int compare(Integer a, Integer b) {
    				return b-a;//æ­¤å¤„ä¸ºé™åºï¼Œa-bä¸ºå‡åº
    			}	
    		});
</code></pre>
<p><em><strong>æ“ä½œæ•°ç»„ï¼šé‡å†™Arrays.sort()</strong></em></p>
<pre><code>Arrays.sort(test, new Comparator&lt;int[]&gt;() {
    //testä¸ºäºŒç»´æ•°ç»„ï¼ŒæŒ‰ç…§å„ä¸€ç»´æ•°ç»„çš„ç¬¬ä¸€ä¸ªæ•°å¤§å°æ¥æ’åº
            @Override
            public int compare(int[] o1, int[] o2) {
                return o1[0]-o2[0];
            }
        });
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[# MyBatiså­¦ä¹ éšç¬”]]></title>
        <id>https://caosy-pmt.github.io/post/mybatis-xue-xi-sui-bi/</id>
        <link href="https://caosy-pmt.github.io/post/mybatis-xue-xi-sui-bi/">
        </link>
        <updated>2021-07-03T07:22:12.000Z</updated>
        <content type="html"><![CDATA[<h3 id="ideaå¸¸ç”¨å¿«æ·é”®"><em><strong>ideaå¸¸ç”¨å¿«æ·é”®</strong></em></h3>
<pre><code>1ã€Ctrl+D å¤åˆ¶å½“å‰è¡Œåˆ°ä¸‹ä¸€è¡Œ 
2ã€Ctrl+N æŸ¥çœ‹å½“å‰ç±»çš„ä¿¡æ¯; Ctrl+Hå®ç°å½“å‰ç±»çš„; Ctrl+B å¿«é€Ÿæ‰“å¼€å…‰æ ‡å¤„çš„ç±»æˆ–æ–¹æ³•
3ã€Alt+0(insert) å®ä½“ç±»å¿«é€Ÿç”Ÿæˆç›¸åº”å‡½æ•° 
4ã€Ctrl+R å…¨å±€æ›¿æ¢ 
5ã€Ctrl+F æŸ¥æ‰¾æ–‡æœ¬
6ã€Ctrl+P æ–¹æ³•å‚æ•°æç¤º
7ã€Ctrl+X åˆ é™¤è¡Œ
8ã€Ctrl+/ æˆ– Ctrl+Shift+/  æ³¨é‡Šï¼ˆ// æˆ–è€…/*...*/ ï¼‰
9ã€Ctrl+J è‡ªåŠ¨ä»£ç ï¼ˆå¸¸è§çš„ä»£ç ç‰‡æ®µï¼‰
10ã€Shift+F6 é‡å‘½å
11ã€sout å¿«é€Ÿæ‰“å‡ºSystem.out.Println()ï¼›
    main/psvm å¿«é€Ÿæ‰“å‡ºpublic static void mainï¼ˆString args[])
12ã€Ctrl+Alt+O å¿«é€Ÿæ¸…é™¤å¤šä½™åŒ…ã€è‡ªåŠ¨å¯¼åŒ…
13ã€Ctrl+P æŸ¥çœ‹æ–¹æ³•å‚æ•°
14ã€Alt+å›è½¦ å®ç°æ¥å£ã€å¼ºåˆ¶è½¬æ¢
</code></pre>
<hr>
<h3 id="jdbcçš„å†—ä½™æ€§"><em><strong>JDBCçš„å†—ä½™æ€§</strong></em></h3>
<pre><code>public void findStudent() {
    Connection conn = null;
    Statement stmt = null;
    ResultSet rs = null;
    try {
        //æ³¨å†Œ mysql é©±åŠ¨
        Class.forName(&quot;com.mysql.jdbc.Driver&quot;);
        //è¿æ¥æ•°æ®çš„åŸºæœ¬ä¿¡æ¯ url ï¼Œusernameï¼Œpassword
        String url = &quot;jdbc:mysql://localhost:3306/springdb&quot;;
        String username = &quot;root&quot;;
        String password = &quot;123456&quot;;
        //åˆ›å»ºè¿æ¥å¯¹è±¡
         conn = DriverManager.getConnection(url, username, password);
        //ä¿å­˜æŸ¥è¯¢ç»“æœ
        List&lt;Student&gt; stuList = new ArrayList&lt;&gt;();
        //åˆ›å»º Statement, ç”¨æ¥æ‰§è¡Œ sql è¯­å¥
        stmt = conn.createStatement();
        //æ‰§è¡ŒæŸ¥è¯¢ï¼Œåˆ›å»ºè®°å½•é›†ï¼Œ
        rs = stmt.executeQuery(&quot;select * from student&quot;);
        while (rs.next()) {
            Student stu = new Student();
            stu.setId(rs.getInt(&quot;id&quot;));
            stu.setName(rs.getString(&quot;name&quot;));
            stu.setAge(rs.getInt(&quot;age&quot;));
            //ä»æ•°æ®åº“å–å‡ºæ•°æ®è½¬ä¸º Student å¯¹è±¡ï¼Œå°è£…åˆ° List é›†åˆ
            stuList.add(stu);
        }
    } catch (Exception e) {
        e.printStackTrace();
    } finally {
        try {
            //å…³é—­èµ„æº
                if (rs != null)  {
                     rs.close();
                 }
                if (stmt != null) {
                    stmt.close();
                }
                if (conn != null) {
                    conn.close();
                }
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
</code></pre>
<hr>
<h3 id="å‡†å¤‡å·¥ä½œ"><em><strong>å‡†å¤‡å·¥ä½œ</strong></em></h3>
<p><strong>1ã€è®¾ç½®æºæ ¹resources</strong><br>
æ–°å»ºé¡¹ç›®æ—¶ï¼Œè¦è®¾ç½®æºæ ¹resources,åç»­ç”¨äºå­˜æ”¾mybatisä¸»é…ç½®æ–‡ä»¶ï¼Œä¸”åªæœ‰ä¸ºæºæ ¹æ—¶ï¼Œcompileåtargetæ–‡ä»¶ä¸­æ‰ä¼šæœ‰resourcesã€‚</p>
<p><strong>2ã€mavenä¾èµ–</strong></p>
<pre><code>        &lt;!-- MyBatisä¾èµ–   --&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;org.mybatis&lt;/groupId&gt;
      &lt;artifactId&gt;mybatis&lt;/artifactId&gt;
      &lt;version&gt;3.5.1&lt;/version&gt;
    &lt;/dependency&gt;ï¼Œ
        &lt;!-- Mysqlé©±åŠ¨   --&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;mysql&lt;/groupId&gt;
      &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;
      &lt;version&gt;5.1.9&lt;/version&gt;
    &lt;/dependency&gt;
</code></pre>
<p><strong>3ã€mavenæ’ä»¶</strong><br>
æ‰«æjavaç›®å½•ä¸‹çš„å…¨éƒ¨propertiesã€xmlæ–‡ä»¶--&gt;target</p>
<pre><code>&lt;resource&gt;
 &lt;directory&gt;src/main/java&lt;/directory&gt;&lt;!--æ‰€åœ¨çš„ç›®å½•--&gt;
 &lt;includes&gt;&lt;!--åŒ…æ‹¬ç›®å½•ä¸‹çš„.properties,.xml æ–‡ä»¶éƒ½ä¼šæ‰«æåˆ°--&gt;
 &lt;include&gt;**/*.properties&lt;/include&gt;
 &lt;include&gt;**/*.xml&lt;/include&gt;
 &lt;/includes&gt;
 &lt;filtering&gt;false&lt;/filtering&gt;
&lt;/resource&gt;
</code></pre>
<hr>
<h3 id="é…ç½®æ–‡ä»¶xml"><em><strong>é…ç½®æ–‡ä»¶.xml</strong></em></h3>
<p>ğŸ˜€åˆ›å»ºæ•°æ®åº“--&gt;å®ä½“ç±»--&gt;Daoæ¥å£ã€æ¥å£é‡Œæ–¹æ³•å£°æ˜--&gt;é…ç½®æ–‡ä»¶ï¼›<br>
ğŸ˜€ideaçš„è‡ªå®šä¹‰ä»£ç æ¨¡æ¿ï¼šè®¾ç½®--&gt;ç¼–è¾‘å™¨--&gt;ä»£ç æ ·å¼--&gt;æ–‡ä»¶å’Œä»£ç æ¨¡æ¿--&gt;&quot;+&quot;ã€‚</p>
<p><strong>1ã€Dao æ¥å£ Mapper æ˜ å°„æ–‡ä»¶</strong></p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
&lt;!DOCTYPE mapper
        PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;
        &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;
&lt;mapper namespace=&quot;åŒådaoæ¥å£çš„å…¨é™å®šåç§°&quot;&gt;
    &lt;select id=&quot;daoæ¥å£ä¸­çš„æ–¹æ³•å&quot; resultType=&quot;&quot;&gt;
        
    &lt;/select&gt;
&lt;/mapper&gt;
</code></pre>
<p><strong>2ã€mybatisä¸»é…ç½®æ–‡ä»¶</strong><br>
ğŸ˜€propertiesæ–‡ä»¶çµæ´»é…ç½®è¿æ¥éœ€è¦çš„æ•°æ®ï¼ˆæ•°æ®åº“åŸºæœ¬ä¿¡æ¯ï¼‰ï¼›<br>
ğŸ˜€è®¾ç½®mybatisè¾“å‡ºæ—¥å¿—ï¼Œä¾¿äºè°ƒè¯•ï¼›<br>
ğŸ˜€sql mapper(sqlæ˜ å°„æ–‡ä»¶)çš„ä½ç½®çš„ä¿©ç§è¡¨ç¤ºï¼šresourceã€package</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
&lt;!DOCTYPE configuration
        PUBLIC &quot;-//mybatis.org//DTD Config 3.0//EN&quot;
        &quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;&gt;
&lt;configuration&gt;

    &lt;!--æŒ‡å®špropertiesæ–‡ä»¶çš„ä½ç½®ï¼Œä»ç±»è·¯å¾„æ ¹å¼€å§‹æ‰¾æ–‡ä»¶ï¼Œçµæ´»é…ç½®ä¸‹é¢è¿æ¥éœ€è¦çš„æ•°æ®--&gt;
    &lt;properties resource=&quot;jdbc.properties&quot; /&gt;

    &lt;!--settingsï¼šæ§åˆ¶mybatiså…¨å±€è¡Œä¸º--&gt;
    &lt;settings&gt;
        &lt;!--mybatisè¾“å‡ºæ—¥å¿—--&gt;
        &lt;setting name=&quot;logImpl&quot; value=&quot;STDOUT_LOGGING&quot;/&gt;
    &lt;/settings&gt;

    &lt;environments default=&quot;mydev&quot;&gt;
        &lt;environment id=&quot;mydev&quot;&gt;
            &lt;transactionManager type=&quot;JDBC&quot;/&gt;
            &lt;dataSource type=&quot;POOLED&quot;&gt;
                &lt;!--ä»jdbc.propertiesä¸­å¾—åˆ°æ•°æ®åº“çš„é©±åŠ¨ç±»å--&gt;
                &lt;property name=&quot;driver&quot; value=&quot;${jdbc.driver}&quot;/&gt;
                &lt;!--è¿æ¥æ•°æ®åº“çš„urlå­—ç¬¦ä¸²--&gt;
                &lt;property name=&quot;url&quot; value=&quot;${jdbc.url}&quot;/&gt;
                &lt;!--è®¿é—®æ•°æ®åº“çš„ç”¨æˆ·å--&gt;
                &lt;property name=&quot;username&quot; value=&quot;${jdbc.user}&quot;/&gt;
                &lt;!--å¯†ç --&gt;
                &lt;property name=&quot;password&quot; value=&quot;${jdbc.passwd}&quot;/&gt;
            &lt;/dataSource&gt;
        &lt;/environment&gt;
    &lt;/environments&gt;

    &lt;!-- sql mapper(sqlæ˜ å°„æ–‡ä»¶)çš„ä½ç½®--&gt;
    &lt;mappers&gt;
        &lt;!--ç¬¬ä¸€ç§æ–¹å¼ï¼šæŒ‡å®šå¤šä¸ªmapperæ–‡ä»¶--&gt;
        &lt;!--&lt;mapper resource=&quot;com/bjpowernode/dao/StudentDao.xml&quot;/&gt;
        &lt;mapper resource=&quot;com/bjpowernode/dao/OrderDao.xml&quot; /&gt;--&gt;

        &lt;!--ç¬¬äºŒç§æ–¹å¼ï¼š ä½¿ç”¨åŒ…å
            name: xmlæ–‡ä»¶ï¼ˆmapperæ–‡ä»¶ï¼‰æ‰€åœ¨çš„åŒ…å, è¿™ä¸ªåŒ…ä¸­æ‰€æœ‰xmlæ–‡ä»¶ä¸€æ¬¡éƒ½èƒ½åŠ è½½ç»™mybatis
            ä½¿ç”¨packageçš„è¦æ±‚ï¼š
             1. mapperæ–‡ä»¶åç§°éœ€è¦å’Œæ¥å£åç§°ä¸€æ ·ï¼Œ åŒºåˆ†å¤§å°å†™çš„ä¸€æ ·
             2. mapperæ–‡ä»¶å’Œdaoæ¥å£éœ€è¦åœ¨åŒä¸€ç›®å½•
        --&gt;
        &lt;package name=&quot;com.csy.dao&quot;/&gt;
    &lt;/mappers&gt;
&lt;/configuration&gt;

</code></pre>
<hr>
<h3 id="å¸¸ç”¨ä»£ç å¯å†™ä¸€ä¸ªå·¥å…·ç±»util"><em><strong>å¸¸ç”¨ä»£ç å¯å†™ä¸€ä¸ªå·¥å…·ç±»util</strong></em></h3>
<p>ğŸ˜€è·å–SqlSessionå¯¹è±¡</p>
<pre><code>public class SqlSessionUtil {
    //å®šä¹‰ SqlSessionFactory
    private static SqlSessionFactory factory = null;
    static {
        //ä½¿ç”¨ é™æ€å— åˆ›å»ºä¸€æ¬¡ SqlSessionFactory
        try{
            ğŸ˜€String config = &quot;mybatis.xml&quot;;
            //è¯»å–é…ç½®æ–‡ä»¶
            InputStream in = Resources.getResourceAsStream(config);
            //åˆ›å»º SqlSessionFactory å¯¹è±¡
            factory = new SqlSessionFactoryBuilder().build(in);
        }catch (Exception e){
            factory = null;
            e.printStackTrace();
        }
    }
    /* è·å– SqlSession å¯¹è±¡ */
    public static SqlSession getSqlSession(){
        SqlSession session = null;
        if( factory != null){
            session = factory.openSession();
        }
        return session;
    }
}
</code></pre>
<hr>
<h3 id="åŠ¨æ€ä»£ç†"><em><strong>åŠ¨æ€ä»£ç†</strong></em></h3>
<p><strong>1ã€ä¼ ç»Ÿçš„Daoå¼€å‘</strong><br>
éœ€è¦åˆ›å»ºå®ç°ç±»ï¼Œå†å®ç°Daoæ¥å£çš„æ–¹æ³•ï¼Œè·å–SqlSessionåä¼šç›´æ¥è°ƒç”¨SqlSessionä¸­çš„å¢åˆ æ”¹æŸ¥æ–¹æ³•ï¼Œå‚æ•°è‡³å°‘ï¼ˆé™¤æŸ¥å¤–éƒ½æœ‰å…¶ä»–å‚æ•°ï¼‰ä¸ºDaoæ¥å£ä¸­å…·ä½“æ–¹æ³•çš„å…¨é™å®šåç§°ï¼Œä»£ç å†—ä½™æ€§æå¤§ï¼Œä¼šæœ‰å¾ˆå¤šç›¸ä¼¼çš„ä»£ç ã€‚<br>
<strong>2ã€åŠ¨æ€ä»£ç†</strong><br>
ä¼šè°ƒç”¨å…¶getMapper(æ¥å£å.class)æ–¹æ³•ï¼ŒåŠ¨æ€ç”Ÿæˆä»£ç†å¯¹è±¡ï¼Œè¯¥å¯¹è±¡å¯è°ƒç”¨Daoæ¥å£ç±»ä¸­ä¸mapperæ–‡ä»¶ä¸­â€idâ€œåŒåçš„æ–¹æ³•ï¼Œå»æ‰§è¡Œä»mapperæ–‡ä»¶ä¸­çš„sqlè¯­å¥ï¼Œå¹¶å¾—åˆ°ç›¸åº”çš„ç»“æœå¯¹è±¡ï¼ˆjdbcä¸­çš„ä¸€ç³»åˆ—æ“ä½œï¼‰ã€‚ä»¥ä¸‹åŠ¨æ€ä»£ç†æ–¹æ³•ï¼š</p>
<pre><code>public void selectAllStudentsTest(){
        SqlSession sqlSession = SqlSessionUtil.getSqlSession();
        StudentDao dao = sqlSession.getMapper(StudentDao.class);
        List&lt;Student&gt; stus =dao.selectAllStudents();
        for(Student stu:stus){
            System.out.println(&quot;å­¦ç”Ÿ&quot;+stu);
        }
        sqlSession.close();
    }
</code></pre>
<hr>
<h3 id="mybatisä¼ é€’å‚æ•°"><em><strong>mybatisä¼ é€’å‚æ•°</strong></em></h3>
<p>ä» java ä»£ç ä¸­æŠŠå‚æ•°ä¼ é€’åˆ° mapper.xml æ–‡ä»¶ã€‚</p>
<p><strong>1ã€ä¸€ä¸ªç®€å•å‚æ•°</strong><br>
ä½¿ç”¨#{id}å ä½ç¬¦ï¼Œå…¶ä¸­idå¯ä¸ºä»»æ„å€¼ï¼š<br>
<code>select * from student where id=#{StudentId}</code></p>
<p><strong>2ã€å¤šä¸ªå‚æ•°</strong><br>
ï¼ˆ1ï¼‰ä½¿ç”¨@Param<br>
mappeæ–‡ä»¶é€šè¿‡ä½¿ç”¨ä¸Daoæ¥å£æ–¹æ³•ä¸­çš„ç›¸åŒåç§°çš„å½¢å‚æ¥ä½¿ç”¨å‚æ•°ï¼Œå³åœ¨æ–¹æ³•å½¢å‚å‰é¢åŠ å…¥@Param(â€œè‡ªå®šä¹‰å‚æ•°åâ€)ï¼Œmapper æ–‡ä»¶ä½¿ç”¨#{è‡ªå®šä¹‰å‚æ•°å}ã€‚<br>
ğŸ˜€æ¥å£æ–¹æ³•ï¼š</p>
<pre><code>public List&lt;Student&gt; selectStudentsByIdAndAge(@Param(&quot;studentId&quot;) int id,
                                            @Param(&quot;studentAge&quot;) int age);
</code></pre>
<p>ğŸ˜€mapperæ–‡ä»¶ï¼š</p>
<pre><code>    &lt;select id=&quot;selectStudentsByIdAndAge&quot; resultType=&quot;com.csy.entity.Student&quot;&gt;
        select * from student where id&gt;#{studentId} and age&gt;#{studentAge}
    &lt;/select&gt;
</code></pre>
<p>(2) ä½¿ç”¨å¯¹è±¡<br>
Daoæ¥å£æ–¹æ³•çš„å½¢å‚ä¸ºå¯¹è±¡ï¼Œæ­¤æ—¶mapperæ–‡ä»¶ä¸­çš„#{}ä¸­ç›´æ¥å†™è¯¥å¯¹è±¡çš„ç›¸åº”å±æ€§<br>
ğŸ˜€æ¥å£æ–¹æ³•ï¼š</p>
<pre><code>public int insertOneStudent(Student stu);
</code></pre>
<p>ğŸ˜€mapperæ–‡ä»¶ï¼š</p>
<pre><code>&lt;insert id=&quot;insertOneStudent&quot; &gt;
        insert into student(id,name,email,age) values(#{id},#{name},#{email},#{age})
&lt;/insert&gt;
</code></pre>
<p><strong>3ã€<code>#</code>ä¸<code>$</code>çš„åŒºåˆ«</strong><br>
ï¼ˆ1ï¼‰<code>#</code>æ˜¯å ä½ç¬¦ï¼Œä½¿ç”¨ï¼Ÿåšå ä½ï¼Œmybatiså†…éƒ¨è°ƒç”¨PreparedStatementå¯¹è±¡æ‰§è¡Œsqlè¯­å¥ï¼Œæ•ˆç‡é«˜ï¼›<br>
ï¼ˆ2ï¼‰<code>#</code>è¡¨ç¤ºåˆ—çš„å€¼ï¼Œä¸€èˆ¬æ”¾åœ¨ç­‰å·çš„å³ä¾§ä½¿ç”¨ï¼›<br>
ï¼ˆ3ï¼‰<code>$</code>æ˜¯å­—ç¬¦ä¸²ä»£ç†è¿æ¥ï¼ŒæŠŠsqlè¯­å¥å’Œ<code>$</code>{}ä½ç½®çš„å€¼è¿æ¥åœ¨ä¸€èµ·ç»„æˆæ–°çš„è¯­å¥ï¼›<br>
ï¼ˆ4ï¼‰<code>$</code>æ‰€è¡¨ç¤ºçš„å†…å®¹æ˜¯åŸæ ·æ›¿æ¢çš„<br>
ï¼ˆ5ï¼‰<code>$</code>ä½¿ç”¨çš„sqlè¯­å¥ï¼Œmybatisä½¿ç”¨çš„æ˜¯Statementå¯¹è±¡æ‰§è¡Œsqlï¼›<br>
ï¼ˆ6ï¼‰<code>$</code>ä¸€èˆ¬æ˜¯å¸¸ç”¨ä½œæ›¿æ¢è¡¨åã€åˆ—åç­‰ï¼Œä¸åšå€¼çš„ä½¿ç”¨ã€‚<br>
ğŸ˜€<code>$</code>çš„å¸¸è§„ç”¨æ³•ï¼š<br>
æ¥å£æ–¹æ³•ï¼š</p>
<pre><code>Student findByDiffField(@Param(&quot;col&quot;) String colunName,@Param(&quot;cval&quot;) Object 
value);
</code></pre>
<p>mapper æ–‡ä»¶ï¼š</p>
<pre><code>&lt;select id=&quot;findByDiffField&quot; resultType=&quot;com.bjpowernode.domain.Student&quot;&gt;
 select * from student where ${col} = #{cval}
&lt;/select&gt;
</code></pre>
<hr>
<h3 id="mybatisè¾“å‡ºç»“æœ"><em><strong>mybatisè¾“å‡ºç»“æœ</strong></em></h3>
<p><strong>ï¼ˆä¸€ï¼‰resultType</strong></p>
<p><strong>1ã€ç®€å•ç±»å‹ï¼ˆintã€String...)</strong></p>
<p><strong>2ã€å¯¹è±¡ç±»å‹</strong></p>
<p><strong>3ã€map</strong><br>
sql çš„æŸ¥è¯¢ç»“æœä½œä¸º Map çš„ key å’Œ valueã€‚æ¨èä½¿ç”¨ Map&lt;Object,Object&gt;ã€‚<br>
æ³¨æ„ï¼šMap ä½œä¸ºæ¥å£è¿”å›å€¼ï¼Œsql è¯­å¥çš„æŸ¥è¯¢ç»“æœæœ€å¤šåªèƒ½æœ‰ä¸€æ¡è®°å½•ã€‚å¤§äºä¸€æ¡è®°å½•æ˜¯é”™è¯¯ã€‚</p>
<p>æ¥å£æ–¹æ³•ï¼š<br>
<code>Map&lt;Object,Object&gt; selectReturnMap(int id);</code></p>
<p>mapper æ–‡ä»¶ï¼š</p>
<pre><code>&lt;select id=&quot;selectReturnMap&quot; resultType=&quot;java.util.HashMap&quot;&gt;
 select * from student where id = #{studentId}
&lt;/select&gt;
</code></pre>
<p>æµ‹è¯•ç»“æœï¼š<br>
<code>mapå¯¹è±¡ï¼š{name=å¼ é£, id=1003, email=zf@163.com, age=19}</code></p>
<p><strong>ï¼ˆäºŒï¼‰resultMap</strong></p>
<p>å¸¸ç”¨äºæ•°æ®åº“åˆ—åä¸javaç±»ä¸­çš„å±æ€§åä¸ä¸€è‡´æ—¶ï¼ˆä¸å¸¸ç”¨ï¼‰ï¼Œé€šå¸¸æƒ…å†µä¸‹æˆ‘ä»¬éƒ½ä¼šå°†å…¶è®¾ä¸ºä¸€è‡´ã€‚</p>
<p>æ­¤å¤„ç¤ºèŒƒä¸€ä¸‹ï¼š</p>
<p>æ¥å£æ–¹æ³•ï¼š<br>
`List<Student> selectUseResultMap(QueryParam param);</p>
<p>mapper æ–‡ä»¶ï¼š</p>
<pre><code>&lt;!-- åˆ›å»º resultMap
    id:è‡ªå®šä¹‰çš„å”¯ä¸€åç§°ï¼Œåœ¨&lt;select&gt;ä½¿ç”¨
    type:æœŸæœ›è½¬ä¸ºçš„ java å¯¹è±¡çš„å…¨é™å®šåç§°æˆ–åˆ«å --&gt;

&lt;resultMap id=&quot;studentMap&quot; type=&quot;com.bjpowernode.domain.Student&quot;&gt;
    &lt;!-- ä¸»é”®å­—æ®µä½¿ç”¨ id --&gt;
    &lt;id column=&quot;id&quot; property=&quot;stuid&quot; /&gt;
    &lt;!--éä¸»é”®å­—æ®µä½¿ç”¨ result--&gt;
    &lt;result column=&quot;name&quot; property=&quot;stuname&quot;/&gt;
    &lt;result column=&quot;email&quot; property=&quot;stuemail&quot; /&gt;
    &lt;result column=&quot;age&quot; property=&quot;stuage&quot; /&gt;
&lt;/resultMap&gt;

&lt;!--resultMap: resultMap æ ‡ç­¾ä¸­çš„ id å±æ€§å€¼--&gt;
&lt;select id=&quot;selectUseResultMap&quot; resultMap=&quot;studentMap&quot;&gt;
    select id,name,email,age from student where name=#{queryName} or age=#
{queryAge}
&lt;/select&gt;
</code></pre>
<p>å…¶ä¸­columnä¸ºæ•°æ®åº“åˆ—åï¼Œpropertyä¸ºè¾“å‡ºçš„javaç±»å¯¹è±¡çš„å±æ€§åã€‚</p>
<p>å¦‚æœè¦ä½¿ç”¨resultTypeå¤„ç†æ­¤ç§æƒ…å†µï¼Œå¯ä½¿ç”¨åˆ—åˆ«åï¼Œåœ¨sqlè¯­å¥ä¸­åŠ å…¥ä¸€äº›ä¸œè¥¿ï¼š<br>
<code>select id as stuid, name as stuname,age as stuage,email as stueamil from student</code></p>
<hr>
<h3 id="æ¨¡ç³ŠæŸ¥è¯¢-like"><em><strong>æ¨¡ç³ŠæŸ¥è¯¢ like</strong></em></h3>
<p><strong>1ã€åœ¨javaä»£ç ä¸­çš„å‚æ•°å…¥æ‰‹</strong></p>
<p>sqlè¯­å¥ï¼š<br>
<code>select * from student where name like #{å‚æ•°}</code><br>
è¿™é‡Œçš„å‚æ•°ä¾‹å¦‚ä¸º`â€œæ%â€ã€‚</p>
<p><strong>2ã€åœ¨mapperæ–‡ä»¶çš„sqlè¯­å¥é‡Œç›´æ¥åŠ </strong></p>
<p>sqlè¯­å¥ï¼š<br>
<code>select * from student where name like #{å‚æ•°} &quot;%&quot;</code><br>
è¿™é‡Œçš„å‚æ•°ä¸º<code>â€œæâ€</code>,è¦æ³¨æ„ä½¿ç”¨ç©ºæ ¼éš”å¼€å‚æ•°ä¸%ã€‚</p>
<hr>
<h3 id="åŠ¨æ€sql"><em><strong>åŠ¨æ€Sql</strong></em></h3>
<p>ä¸»è¦æ˜¯é€šè¿‡å¸¸ç”¨çš„åŠ¨æ€ SQL æ ‡ç­¾æœ‰<code>&lt;if&gt;ã€&lt;where&gt;ã€&lt;foreach&gt;</code>æ¥åŠ¨æ€æ‹¼æ¥sqlè¯­å¥ã€‚</p>
<p><strong>1ã€<code>&lt;if&gt; ä¸ &lt;where&gt;</code></strong><br>
<code>&lt;if&gt;</code>å•ç‹¬ä½¿ç”¨æ—¶æœ€å‰é¢éœ€è¦åŠ ä¸€ä¸ªæ’ç­‰å¼ï¼Œä¿è¯åé¢çš„è¿æ¥è¯ï¼ˆandã€or...)ä¸ä¼šæŠ¥é”™ï¼Œæ‰€ä»¥å¸¸å¸¸ä¼šä¸<code>&lt;where&gt;</code>æ ‡ç­¾è¿ç”¨ã€‚</p>
<p>æ¥å£æ–¹æ³•ï¼š<br>
<code>List&lt;Student&gt; selectStudentsSqlIf2(@Param(&quot;stuName&quot;) String name,@Param(&quot;stuAge&quot;) int age);</code></p>
<p>å•ç‹¬çš„if-sqlè¯­å¥ï¼š</p>
<pre><code>select id,name,email,age from student
        where 1=1
        &lt;if test=&quot;stuName != null and stuName !='' &quot;&gt;
            and name = #{stuName}
        &lt;/if&gt;
        &lt;if test=&quot;stuAge &gt; 0 &quot;&gt;
            and age &amp;gt; #{stuAge}
        &lt;/if&gt;
</code></pre>
<p>ä¸Šè¿°ä¸ºç®€å•ç±»å‹å‚æ•°ï¼Œè‹¥ä¸ºå¯¹è±¡ç±»å‹å‚æ•°ï¼Œtestä¸­å¯ç›´æ¥ä½¿ç”¨javaç±»çš„å±æ€§åï¼Œç”±mybatiså»getã€‚</p>
<p>if-where Sqlè¯­å¥ï¼šå°†<code>where æ’ç­‰å¼ï¼ˆ1=1ï¼‰</code>æ”¹ä¸º <code>&lt;where&gt;&lt;/where&gt;</code>åŒ…ä½ifè¯­å¥</p>
<p><strong>2ã€<code>&lt;foreach&gt;</code></strong></p>
<p>æ¥å£æ–¹æ³•ï¼š<br>
<code>List&lt;Student&gt; selectStudentsByForeach(List&lt;Integer&gt; idList);</code></p>
<p>mapper æ–‡ä»¶ï¼š</p>
<pre><code>    &lt;select id=&quot;selectStudentsByForeach2&quot; resultType=&quot;com.csy.entity.Student&quot;&gt;
        select id,name,email,age from student
        &lt;if test=&quot;array.length&gt;0 &quot;&gt;
            /*testä¸­ä½¿ç”¨@Paramå¯ç”¨è‡ªå·±è®¾ç½®çš„åç§°ï¼ˆidListï¼‰,å¦åˆ™åªèƒ½æ˜¯listã€arrayäº¤ç»™mybatisè‡ªå·±å»æ‰¾é›†åˆ*/
            where id in
            &lt;foreach collection=&quot;array&quot; item=&quot;stuId&quot; open=&quot;(&quot; close=&quot;)&quot; separator=&quot;,&quot;&gt;
                  /*æ­¤å¤„collection ä¸å‰é¢çš„testè¦ä¸€è‡´*/
                #{stuId}
            &lt;/foreach&gt;
        &lt;/if&gt;
    &lt;/select&gt;
</code></pre>
<p>æ³¨æ„foreachå„å‚æ•°é—´ç”¨ç©ºæ ¼éš”å¼€ï¼Œitem=&quot;é›†åˆä¸­çš„æˆå‘˜&quot;ï¼Œopenã€closeã€separatoråˆ†åˆ«è¡¨ç¤ºæ‰€æ’å…¥sqlç‰‡æ®µçš„å¼€å§‹ã€ç»“æŸåŠåˆ†å‰²ç¬¦ã€‚</p>
<p><strong>3ã€Sqlä»£ç ç‰‡æ®µ</strong></p>
<p>mapper æ–‡ä»¶ï¼š</p>
<pre><code>&lt;!--åˆ›å»º sql ç‰‡æ®µ id:ç‰‡æ®µçš„è‡ªå®šä¹‰åç§°--&gt;
&lt;sql id=&quot;studentSql&quot;&gt;
 select id,name,email,age from student
&lt;/sql&gt;

&lt;!-- å¼•ç”¨ sql ç‰‡æ®µ --&gt;
 &lt;include refid=&quot;studentSql&quot;/&gt; /*ä»£æ›¿ä¹‹å‰å®šä¹‰çš„ä»£ç ç‰‡æ®µ*/
</code></pre>
<hr>
<h3 id="typealiasesç±»å‹åˆ«å">typeAliasesç±»å‹åˆ«å</h3>
<p>Mybatis æ”¯æŒé»˜è®¤åˆ«åï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é‡‡ç”¨è‡ªå®šä¹‰åˆ«åæ–¹å¼æ¥å¼€å‘ï¼Œä¸»è¦ä½¿ç”¨åœ¨<code>&lt;select resultType=â€åˆ«åâ€&gt;</code><br>
mybatis.xml ä¸»é…ç½®æ–‡ä»¶å®šä¹‰åˆ«åï¼š</p>
<pre><code>&lt;typeAliases&gt;
    &lt;!--å®šä¹‰å•ä¸ªç±»å‹çš„åˆ«å
        type:ç±»å‹çš„å…¨é™å®šåç§°
        alias:è‡ªå®šä¹‰åˆ«å --&gt;
    &lt;typeAlias type=&quot;com.csy.domain.Student&quot; alias=&quot;mystudent&quot;/&gt;
    &lt;!--æ‰¹é‡å®šä¹‰åˆ«åï¼Œæ‰«ææ•´ä¸ªåŒ…ä¸‹çš„ç±»ï¼Œåˆ«åä¸ºç±»åï¼ˆé¦–å­—æ¯å¤§å†™æˆ–å°å†™éƒ½å¯ä»¥ï¼‰
                        name:åŒ…å--&gt;
    &lt;package name=&quot;com.csy.domain&quot;/&gt;
    &lt;package name=&quot;...å…¶ä»–åŒ…&quot;/&gt;
&lt;/typeAliases&gt;
</code></pre>
<p>mapper.xml æ–‡ä»¶ï¼Œä½¿ç”¨åˆ«åè¡¨ç¤ºç±»å‹</p>
<pre><code>&lt;select id=&quot;selectStudents&quot; resultType=&quot;mystudent&quot;&gt;
 select id,name,email,age from student
&lt;/select&gt;
</code></pre>
<h3 id="åŸºäº-pagehelper-åˆ†é¡µ"><em><strong>åŸºäº PageHelper åˆ†é¡µ</strong></em></h3>
<p><strong>1ã€mavenåæ ‡</strong></p>
<pre><code>&lt;dependency&gt;
 &lt;groupId&gt;com.github.pagehelper&lt;/groupId&gt;
 &lt;artifactId&gt;pagehelper&lt;/artifactId&gt;
 &lt;version&gt;5.1.10&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<p><strong>2ã€åŠ å…¥ plugin é…ç½®</strong></p>
<pre><code>åœ¨&lt;environments&gt;ä¹‹å‰åŠ å…¥
&lt;plugins&gt;
 &lt;plugin interceptor=&quot;com.github.pagehelper.PageInterceptor&quot; /&gt;
&lt;/plugins&gt;
</code></pre>
<p><strong>3ã€ç”¨æ³•</strong></p>
<p>æŸ¥è¯¢è¯­å¥ä¹‹å‰è°ƒç”¨ PageHelper.startPage ï¼ˆ,ï¼‰é™æ€æ–¹æ³•ã€‚ï¼Œç´§è·Ÿåœ¨è¿™ä¸ªæ–¹æ³•åçš„ç¬¬ä¸€ä¸ª MyBatis æŸ¥è¯¢æ–¹æ³•ä¼šè¢«è¿›è¡Œåˆ†é¡µã€‚</p>
<p>//è·å–ç¬¬ 1 é¡µï¼Œ3 æ¡å†…å®¹<br>
<code>PageHelper.startPage(1,3);</code></p>
]]></content>
    </entry>
</feed>